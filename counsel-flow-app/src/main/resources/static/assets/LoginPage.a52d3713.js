import{x as R,r as l,y as $,o as _,c as z,w as i,a as o,Q as V,z as s,A as y,B as x,C as B,D as w,E as C,F as K,G,H,I as M}from"./index.02f7c95d.js";import{Q as O}from"./QPage.83a32369.js";import{C as F}from"./ClosePopup.daa62b28.js";import{_ as W,s as J}from"./initialSetup.96ff5b0b.js";import{u as Y,a as T}from"./authStore.fadf8446.js";import{C as j}from"./index.9642ecdd.js";import{t as X}from"./taskRequestApi.54be001b.js";import{s as u,a as Z}from"./dialog.88ce899f.js";import ee from"./ALoadingSpinner.ca275fb8.js";import{h as te}from"./errorHandler.5efe1eb1.js";import"./counselTypeStore.5faa86f9.js";import"./axios.816e1a60.js";import"./header.10137493.js";import"./organizationStore.a86bd6ff.js";import"./codeStore.e69f9e04.js";import"./systemVariableStore.28d075a0.js";import"./representativeServiceStore.1d850f8a.js";import"./permissionStore.29c18612.js";import"./permissionApi.ffe0b82d.js";import"./commandStore.9ed00edb.js";import"./FlowSystemCode.7be7ce49.js";import"./menuStore.ccd61f24.js";import"./menuApi.a7c1508d.js";import"./_commonjsHelpers.c10bf6cb.js";import"./_commonjs-dynamic-modules.30ae7933.js";import"./CommonPopup.2b0ee10b.js";import"./use-dialog-plugin-component.234e0905.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./counsel-hub.145170b4.js";const ae={class:"col-6 q-pl-md q-gutter-y-md"},oe={class:"row"},le={class:"col-6 row q-gutter-sm"},se={class:"col-6 flex flex-center"},Ne={__name:"LoginPage",setup(re){const h=R(),k=Y(),f=l(!1),r=l(""),g=l(""),n=l(""),m=l(""),d=l(!1),p=l(!1),c=l(""),I=l(!1),S=l(!1);$(()=>{d.value=localStorage.getItem("saveId")==="true",p.value=localStorage.getItem("saveCTI")==="true",d.value&&(c.value=localStorage.getItem("savedUserId"),c.value&&(r.value=c.value))});function U(){d.value?(localStorage.setItem("saveId",!0),localStorage.setItem("savedUserId",r.value)):(localStorage.setItem("saveId",!1),localStorage.removeItem("savedUserId")),p.value?localStorage.setItem("saveCTI",!0):localStorage.setItem("saveCTI",!1)}function v(){if(!r.value.trim()||!g.value.trim()){u("\uC544\uC774\uB514\uC640 \uBE44\uBC00\uBC88\uD638\uB97C \uBAA8\uB450 \uC785\uB825\uD574\uC57C \uD569\uB2C8\uB2E4.");return}f.value=!0,T.login(r.value,j.SHA256(g.value).toString()).then(e=>{e.status===200&&(console.log(e),d.value&&(c.value=localStorage.getItem("savedUserId")),localStorage.clear(),localStorage.setItem("accessToken",e.data.accessToken),localStorage.setItem("accessExpirationTime",e.data.accessExpirationTime),localStorage.setItem("accessTokenExpiresIn",e.data.accessTokenExpiresIn),localStorage.setItem("refreshToken",e.data.refreshToken),localStorage.setItem("refreshExpirationTime",e.data.refreshExpirationTime),localStorage.setItem("refreshTokenExpiresIn",e.data.refreshTokenExpiresIn),localStorage.setItem("saveId",d.value),localStorage.setItem("savedUserId",c.value),m.value&&localStorage.setItem("ctiExtension",m.value),E().then(t=>{k.login(t).then(()=>{U(),J().then(()=>{h.push({name:"main"})}).catch(a=>{te(a)})})}))}).catch(e=>{if(e.response.status===500&&e.response.data.code==="1000"){u("\uC544\uC774\uB514 \uB610\uB294 \uBE44\uBC00\uBC88\uD638\uB97C \uD655\uC778\uD574\uC8FC\uC138\uC694.");return}console.log(e)}).finally(()=>{f.value=!1})}async function E(){try{const e=await T.getUserInfo();let t={entityId:e.data.entityId,useTypeCode:e.data.useTypeCode,id:e.data.id,name:e.data.name,email:e.data.email,roleGroup:e.data.roleGroup,organization:e.data.organization,ctiLoginId:e.data.ctiLoginId,ctiLoginPassword:e.data.ctiLoginPassword,ctiExtension:m.value?m.value:e.data.ctiExtension,ctiAutoLogin:p.value};return Promise.resolve(t)}catch(e){console.log(e)}}function b(){if(!r.value.trim()){u("\uC544\uC774\uB514\uB97C \uC785\uB825\uD558\uC138\uC694.");return}S.value=!0}function q(){if(!n.value.trim()){u("\uC0AC\uC6A9\uC790\uBA85\uC744 \uC785\uB825\uD558\uC138\uC694.");return}S.value=!1,P()}function A(){const e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),Q=String(e.getDate()).padStart(2,"0"),D=String(e.getHours()).padStart(2,"0"),L=String(e.getMinutes()).padStart(2,"0"),N=String(e.getSeconds()).padStart(2,"0");return`${t}-${a}-${Q} ${D}:${L}:${N}`}async function P(){if(await Z("\uBE44\uBC00\uBC88\uD638 \uCD08\uAE30\uD654 \uC694\uCCAD \uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")){const t={"entity.requestType":"INIT_PASSWORD","entity.stateType":"IN_PROGRESS","entity.requestor.id":r.value,"entity.requestor.name":n.value,"entity.responseDate":A()};X.postPasswordReset(t).then(a=>{a.status===200&&(u("\uBE44\uBC00\uBC88\uD638 \uCD08\uAE30\uD654 \uC694\uCCAD\uC744 \uBCF4\uB0C8\uC2B5\uB2C8\uB2E4."),n.value="")}).catch(a=>{a.response&&a.response.data.message?a.response.data.code==="1007"?(u("\uC544\uC774\uB514 \uB610\uB294 \uC0AC\uC6A9\uC790\uBA85\uC744 \uD655\uC778 \uD574\uC8FC\uC138\uC694."),n.value=""):(u(a.response.data.message),n.value=""):(u("\uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC2DC\uB3C4\uD574 \uC8FC\uC138\uC694."),n.value="")})}}return(e,t)=>(_(),z(O,{class:"flex flex-center"},{default:i(()=>[o(V,{class:"q-pa-md row",style:{width:"700px"}},{default:i(()=>[t[10]||(t[10]=s("div",{class:"col-6 flex flex-center"},[s("img",{src:W,class:"full-width"})],-1)),s("div",ae,[s("form",null,[o(y,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),label:"\uC544\uC774\uB514",onKeyup:x(v,["enter"])},null,8,["modelValue"]),o(y,{modelValue:g.value,"onUpdate:modelValue":t[2]||(t[2]=a=>g.value=a),label:"\uBE44\uBC00\uBC88\uD638",type:I.value?"text":"password",onKeyup:x(v,["enter"]),autoComplete:"off"},{append:i(()=>[o(B,{name:I.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[1]||(t[1]=a=>I.value=!I.value),onKeyup:x(v,["enter"])},null,8,["name"])]),_:1},8,["modelValue","type"]),o(y,{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=a=>m.value=a),label:"\uB0B4\uC120\uBC88\uD638",onKeyup:x(v,["enter"])},null,8,["modelValue"])]),s("div",oe,[s("div",le,[o(w,{modelValue:d.value,"onUpdate:modelValue":t[4]||(t[4]=a=>d.value=a),label:"\uC544\uC774\uB514 \uC800\uC7A5",dense:""},null,8,["modelValue"]),o(w,{modelValue:p.value,"onUpdate:modelValue":t[5]||(t[5]=a=>p.value=a),label:"CTI \uB85C\uADF8\uC778",dense:""},null,8,["modelValue"]),o(C,{dense:"",flat:"",color:"primary",size:"sm",onClick:b},{default:i(()=>t[9]||(t[9]=[s("div",{class:"text-left"},"\uBE44\uBC00\uBC88\uD638 \uCD08\uAE30\uD654 \uC694\uCCAD",-1)])),_:1})]),s("div",se,[o(C,{class:"full-width",label:"\uB85C\uADF8\uC778",color:"primary",size:"lg",onClick:v})])])])]),_:1}),o(K,{modelValue:S.value,"onUpdate:modelValue":t[7]||(t[7]=a=>S.value=a)},{default:i(()=>[o(V,{class:"q-dialog-plugin"},{default:i(()=>[o(G,{class:"q-mt-md text-center q-pt-none"},{default:i(()=>[t[11]||(t[11]=s("div",null,"\uC0AC\uC6A9\uC790\uBA85\uC744 \uC785\uB825\uD558\uC138\uC694",-1)),o(y,{modelValue:n.value,"onUpdate:modelValue":t[6]||(t[6]=a=>n.value=a),label:"\uC0AC\uC6A9\uC790\uBA85"},null,8,["modelValue"])]),_:1}),o(H,{class:"row q-gutter-md",align:"center"},{default:i(()=>[o(C,{label:"\uC608",color:"primary",onClick:q}),M(o(C,{label:"\uC544\uB2C8\uC694",color:"negative"},null,512),[[F]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ee,{modelValue:f.value,"onUpdate:modelValue":t[8]||(t[8]=a=>f.value=a)},null,8,["modelValue"])]),_:1}))}};export{Ne as default};
