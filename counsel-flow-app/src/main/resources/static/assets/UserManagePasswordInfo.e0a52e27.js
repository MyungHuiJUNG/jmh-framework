import N from"./TabulatorGrid.9c80b09d.js";import f from"./ABtn.e24d7e8a.js";import{t as p}from"./taskRequestApi.54be001b.js";import{u as V}from"./organizationStore.a86bd6ff.js";import{s as c,a as z}from"./dialog.88ce899f.js";import{h as D}from"./errorHandler.5efe1eb1.js";import{F as $}from"./FlowSystemCode.7be7ce49.js";import k from"./ATitleBar.bbf1d9a4.js";import{F as H}from"./FlowRoleCode.12cdb02e.js";import{u as U}from"./permissionStore.29c18612.js";import x from"./ALoadingSpinner.ca275fb8.js";import{g as M,r as u,y as b,o as h,Y as F,a as d,z as O,c as A,Z as R}from"./index.02f7c95d.js";/* empty css                                                             */import"./_plugin-vue_export-helper.cdc0426e.js";import"./axios.816e1a60.js";import"./header.10137493.js";import"./CommonPopup.2b0ee10b.js";import"./use-dialog-plugin-component.234e0905.js";import"./authStore.fadf8446.js";import"./counsel-hub.145170b4.js";import"./ClosePopup.daa62b28.js";import"./permissionApi.ffe0b82d.js";const B={class:"column fit no-wrap",style:{height:"220px"}},W={class:"text-right bg-grey-5 q-pa-xs col-auto full-width"},fe={__name:"UserManagePasswordInfo",setup(L){const C=$.USE_CD.USE,_=U(),S=M(()=>_.hasPermission(H.REQUEST_MANAGEMENT.REQUEST_INIT_PWD_APPROVAL)),m=V(),g=u(null),q=u([]),i=u(!1),I=[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerHozAlign:"center",headerSort:!1,width:20},{title:"#",field:"rownum",formatter:"rownum",headerHozAlign:"center",hozAlign:"center",headerSort:!1,resizable:!1,width:50},{title:"\uC870\uC9C1(\uB300)",field:"requestor.organization",hozAlign:"center",headerHozAlign:"center",headerSort:!0,formatter:function(t){const e=t.getValue();return e&&e.path&&e.path.split(".")[0]?m.organizations.get(e.path.split(".")[0]||"").name:""}},{title:"\uC870\uC9C1(\uC911)",field:"requestor.organization",hozAlign:"center",headerHozAlign:"center",headerSort:!0,formatter:function(t){const e=t.getValue();return e&&e.path&&e.path.split(".")[1]?m.organizations.get(e.path.split(".")[1]||"").name:""}},{title:"\uC870\uC9C1(\uC18C)",field:"requestor.organization",hozAlign:"center",headerHozAlign:"center",headerSort:!0,formatter:function(t){const e=t.getValue();return e&&e.path&&e.path.split(".")[2]?m.organizations.get(e.path.split(".")[2]||"").name:""}},{title:"\uC0AC\uC6A9\uC790\uBA85",field:"requestor.name",hozAlign:"center",headerHozAlign:"center",headerSort:!0},{title:"\uC544\uC774\uB514",field:"requestor.id",hozAlign:"center",headerHozAlign:"center",headerSort:!0},{title:"\uC0AC\uC6A9\uC5EC\uBD80",field:"requestor.useTypeCode",hozAlign:"center",headerHozAlign:"center",headerSort:!0,formatter:function(t){const e=t.getValue();return(e&&e.value?e.value:e)===C?"\uC0AC\uC6A9":"\uC0AC\uC6A9 \uC548\uD568"}},{title:"CTI ID",field:"requestor.ctiLoginId",hozAlign:"center",headerHozAlign:"center",headerSort:!0},{title:"\uB0B4\uC120\uBC88\uD638",field:"requestor.ctiExtension",hozAlign:"center",headerHozAlign:"center",headerSort:!0}],w=u([]);function P(t){q.value=t}function l(){i.value=!0;const t={"entity.requestType":"INIT_PASSWORD","entity.stateType":"IN_PROGRESS"};p.getPasswordResetRequestor(t).then(e=>{e.status===200&&(w.value=e.data)}).catch(e=>{D(e)}).finally(()=>{i.value=!1})}function y(){const t=new Date,e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0"),s=String(t.getSeconds()).padStart(2,"0");return`${e}-${r}-${o} ${n}:${a}:${s}`}async function T(){const t=g.value.getSelectedData();if(t.length===0){c("\uC120\uD0DD\uB41C \uC0AC\uC6A9\uC790\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.");return}if(await z("\uCD08\uAE30\uD654 \uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")){let r=0,o=0;for(const a of t){const s={"entity.requestType":"INIT_PASSWORD","entity.stateType":"ACCEPT","entity.requestor.entityId":a.requestor.entityId,"entity.responseDate":y()};try{await p.putPasswordReset(a.entityId,s),r++}catch{o++}}let n=`${r}\uBA85\uC758 \uC0AC\uC6A9\uC790\uC758 \uBE44\uBC00\uBC88\uD638\uAC00 \uCD08\uAE30\uD654\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`;o>0&&(n+=`
${o}\uBA85\uC758 \uC0AC\uC6A9\uC790\uC5D0\uC11C \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.`),l(),c(n)}}async function v(){const t=g.value.getSelectedData();if(t.length===0){c("\uC120\uD0DD\uB41C \uC0AC\uC6A9\uC790\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.");return}if(await z("\uC0AD\uC81C \uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")){let r=0,o=0;for(const a of t){const s={"entity.requestType":"INIT_PASSWORD","entity.stateType":"REJECT","entity.requestor.entityId":a.requestor.entityId,"entity.responseDate":y()};try{await p.putPasswordReset(a.entityId,s),r++}catch{o++}}let n=`${r}\uBA85\uC758 \uC0AC\uC6A9\uC790\uC758 \uBE44\uBC00\uBC88\uD638 \uCD08\uAE30\uD654\uB97C \uAC70\uC808\uD558\uC600\uC2B5\uB2C8\uB2E4.`;o>0&&(n+=`
${o}\uBA85\uC758 \uC0AC\uC6A9\uC790\uC5D0\uC11C \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.`),l(),c(n)}}return b(()=>l()),(t,e)=>(h(),F("div",B,[d(k,{title:"\uBE44\uBC00\uBC88\uD638 \uCD08\uAE30\uD654 \uC694\uCCAD\uC790",class:"col-auto full-width q-mb-xs"}),d(N,{rows:w.value,columns:I,selectableRows:!0,onRowSelected:P,selectableRowsRangeMode:"click",class:"col",ref_key:"childRef",ref:g},null,8,["rows"]),O("div",W,[S.value?(h(),A(f,{key:0,label:"\uC0AD\uC81C",onClick:v})):R("",!0),S.value?(h(),A(f,{key:1,label:"\uBE44\uBC00\uBC88\uD638 \uCD08\uAE30\uD654",onClick:T,class:"q-ml-xs"})):R("",!0),d(f,{label:"\uBAA9\uB85D \uC0C8\uB85C\uACE0\uCE68",onClick:l,class:"q-ml-xs"})]),d(x,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=r=>i.value=r)},null,8,["modelValue"])]))}};export{fe as default};
