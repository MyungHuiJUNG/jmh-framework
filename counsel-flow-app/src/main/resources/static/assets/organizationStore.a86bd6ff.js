import{d as f}from"./index.02f7c95d.js";import{api as c}from"./axios.816e1a60.js";import{g as h}from"./header.10137493.js";const m=(n,t)=>{let r=n?`/rest/api/v1/organization/organizations/${n}`:"/rest/api/v1/organization/organizations";return typeof t!="undefined"&&(r+=`?isTopCode=${t}`),c.get(r,h())},z=(n,t,r,i)=>c.post("/rest/api/v1/organization/organizations",{entity:{code:n,name:t,orderNumber:i,parent:{entityId:r}}},h()),O=(n,t,r,i,e)=>{const a={code:t,name:r,orderNumber:e};return i&&(a.parent={entityId:i}),c.put(`/rest/api/v1/organization/organizations/${n}`,{entity:a},h())},I=n=>c.post("/rest/api/v1/organization/organizations/multiple",{entities:n},h()),A=n=>c.put("/rest/api/v1/organization/organizations/multiple",{entities:n},h()),y=n=>c.delete(`/rest/api/v1/organization/organizations/${n}`,h()),v=n=>{const t=n.join(",");return c.delete("/rest/api/v1/organization/organizations",{...h(),params:{entityIds:t}})},g={getOrg:m,saveOrg:z,saveMultipleOrg:I,updateMultipleOrg:A,updateOrg:O,deleteOrg:y,deleteMultipleOrgs:v},P=f("organizationStore",{state:()=>({organizations:new Map,organizationArray:[],recid:1,initialLoaded:!1}),getters:{getOrganization:n=>(t,r)=>{if(!t)return null;let i=Array.isArray(t)?t:t.children;return i!=null&&i.length&&i.find(e=>e.code===r)||null},getOrganizationName:n=>(t,r)=>{if(!t)return null;let i=Array.isArray(t)?t:t.children;if(!(i!=null&&i.length))return null;const e=i.find(a=>a.code===r);return e?e.name:null},getOrganizationByEntityId:n=>(t,r)=>{if(!t)return null;let i=Array.isArray(t)?t:t.children;return i!=null&&i.length&&i.find(e=>e.entityId===r)||null},getChildrenOrganizationsByTopParentCodeValue:n=>t=>{const r=n.organizations.get(t);return(r==null?void 0:r.children)||[]},getChildrenOrganizationNamesByTopParentCodeValue:n=>t=>{var i;const r=n.organizations.get(t);return((i=r==null?void 0:r.children)==null?void 0:i.map(e=>e.name))||[]},findOrganizationsInTopParentCodeValue:n=>(t,r,i)=>{function e(u,s,l){!(s!=null&&s.children)||s.children.forEach(d=>{d.code===l&&u.push(d),e(u,d,l)})}const a=[],o=n.organizations.get(t);return o&&e(a,o,r),i?a[0]||null:a},findOrganizationNamesInTopParentCodeValue:n=>(t,r,i)=>{function e(u,s,l){!(s!=null&&s.children)||s.children.forEach(d=>{d.code===l&&u.push(d.name),e(u,d,l)})}const a=[],o=n.organizations.get(t);return o&&e(a,o,r),i?a[0]||null:a},findParentOrganizationByChildren:n=>t=>{if(!(t!=null&&t.parentEntityId))return n.organizationArray;let r=null;function i(e){e.forEach(a=>{var o;t.parentEntityId===a.entityId?r=a.children||[]:(o=a.children)!=null&&o.length&&i(a.children)})}return i(n.organizationArray),r||n.organizationArray},findParentCode:n=>t=>{if(!(t!=null&&t.parentEntityId))return null;let r=null;function i(e){e.forEach(a=>{t.parentEntityId===a.entityId?r=a:a.children&&a.children.length>0&&i(a.children)})}return i(n.organizationArray),r},findIndexInParentOrganizationChildren:n=>(t,r)=>t.findIndex(i=>i.entityId===r.entityId)},actions:{setOrganizations(n){this.organizations=new Map,n.forEach(t=>{var r;(r=t.children)!=null&&r.length&&t.children.sort((i,e)=>i.orderNumber!==e.orderNumber?i.orderNumber-e.orderNumber:i.name.localeCompare(e.name)),this.organizations.set(t.code,t)})},setOrganizationArray(n){this.recid=1;const t=(r,i)=>{r.sort((e,a)=>e.orderNumber!==a.orderNumber?e.orderNumber-a.orderNumber:e.name.localeCompare(a.name)),r.forEach(e=>{var a;e.recid=this.recid++,e.remarkText||(e.remarkText=""),i&&(e.parentCode=i.code,e.parentEntityId=i.entityId,e.parentRecid=i.recid,e.prevParentEntityId=i.entityId),(a=e.children)!=null&&a.length&&t(e.children,e)})};this.organizationArray=n,t(this.organizationArray)},load(){g.getOrg(null,!1).then(n=>{n.status===200&&this.setOrganizations(n.data)}).catch(n=>{console.log(n)}),g.getOrg(null).then(n=>{n.status===200&&this.setOrganizationArray(n.data)}).catch(n=>{console.log(n)})},fetchInitialData(){return this.initialLoaded?Promise.resolve():(this.initialLoaded=!0,Promise.all([g.getOrg(null,!1),g.getOrg(null)]).then(([n,t])=>{this.setOrganizations(n.data),this.setOrganizationArray(t.data)}).catch(n=>{throw this.initialLoaded=!1,n}))},clearInitialData(){this.initialLoaded=!1,this.clear()},clear(){this.setOrganizations([]),this.setOrganizationArray([])},async save(n){try{const t=await g.saveMultipleOrg(n);return t.status===200&&this.load(),t}catch(t){throw console.log(t),t}},async update(n){try{const t=await g.updateMultipleOrg(n);return t.status===200&&this.load(),t}catch(t){throw console.log(t),t}},async remove(n){try{const t=await g.deleteOrg(n);return t.status===200&&this.load(),t}catch(t){throw console.log(t),t}},search(n={}){return new Promise(t=>{if(!n.name&&!n.code){t([...this.organizationArray]);return}const r=i=>i.reduce((e,a)=>{var l;const o={...a},u=!n.code||o.code.includes(n.code),s=!n.name||o.name.includes(n.name);return u&&s&&e.push(o),(l=o.children)!=null&&l.length&&e.push(...r(o.children)),e},[]);t(r(this.organizationArray))})}}});export{g as o,P as u};
