import{r as o,g as K,t as n,o as Ve,Y as be,z as a,a as u,B as Z}from"./index.02f7c95d.js";import{u as Te}from"./use-quasar.2d4ce40a.js";import{u as _e}from"./counselTypeStore.5faa86f9.js";import{u as ge}from"./codeStore.e69f9e04.js";import{s as ee}from"./dialog.88ce899f.js";import q from"./ASelect.a02a29e0.js";import A from"./AInput.398f059b.js";import L from"./ABtn.e24d7e8a.js";import r from"./ACheckbox.923db872.js";import le from"./UserPopup.4dc2e487.js";import{t as he}from"./ticketApi.d3774daa.js";import{h as we}from"./errorHandler.5efe1eb1.js";import{F as B}from"./FlowSystemCode.7be7ce49.js";import{_ as Se}from"./_plugin-vue_export-helper.cdc0426e.js";import"./axios.816e1a60.js";import"./header.10137493.js";import"./CommonPopup.2b0ee10b.js";import"./use-dialog-plugin-component.234e0905.js";import"./QItem.1bce08e7.js";import"./QSelect.b17c746f.js";import"./QMenu.3c9cf304.js";import"./position-engine.53490cc8.js";import"./rtl.276c3f1b.js";import"./format.2cae61da.js";/* empty css                                                             */import"./TabulatorGrid.9c80b09d.js";import"./ATitleBar.bbf1d9a4.js";import"./ClosePopup.daa62b28.js";import"./organizationStore.a86bd6ff.js";import"./userApi.abe7b8c8.js";import"./ALoadingSpinner.ca275fb8.js";import"./authStore.fadf8446.js";import"./counsel-hub.145170b4.js";const De={class:"column"},Ee={class:"col-auto row fixed-height"},Ue={class:"col-auto t-column text-left top-border-left justify-center column q-px-xs"},ke={class:"col top-border-left justify-center column q-px-xs width-20"},qe={class:"row full-width no-wrap"},Ae={class:"col-auto t-column text-left top-border-left justify-center column q-px-xs"},Oe={class:"col top-border-left justify-center column q-px-xs width-25"},je={class:"col-auto t-column text-left top-border-left justify-center column q-px-xs"},Ie={class:"col top-border-right justify-center column q-px-xs width-25"},Me={class:"row no-wrap"},Le={class:"col-auto row fixed-height"},Re={class:"col-auto t-column text-left body-border-left justify-center column q-px-xs"},Pe={class:"col body-border-left justify-center column q-px-xs width-20"},$e={class:"col-auto t-column text-left body-border-left justify-center column q-px-xs"},Ke={class:"col body-border-left justify-center column q-px-xs width-25"},Be={class:"col-auto t-column text-left body-border-left justify-center column q-px-xs"},Fe={class:"col body-border-right justify-center column q-px-xs width-25"},Ye={class:"row no-wrap"},Ne={class:"col-auto row fixed-height"},Ge={class:"col-auto t-column text-left body-border-left justify-center column q-px-xs"},He={class:"col body-border-left justify-center column q-px-xs width-20"},ze={class:"col-auto t-column text-left body-border-left justify-center column q-px-xs"},Qe={class:"col body-border-left justify-center column q-px-xs width-25"},We={class:"row full-width no-wrap"},Xe={class:"col-auto t-column text-left body-border-left justify-center column q-px-xs"},Je={class:"col body-border-right justify-center column q-px-xs width-25"},Ze={class:"row justify-between full-width no-wrap"},el={class:"col-4"},ll={class:"col-auto q-ml-xs text-right"},tl=31,ol="\uAE30\uAC04\uC740 \uCD5C\uB300 31\uC77C\uAE4C\uC9C0\uB9CC \uC124\uC815\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4.",al={__name:"TicketManageSearch",props:["hasDatas"],emits:["search"],setup(te,{emit:oe}){const Q=Te(),ae=te,ue=oe,F=_e(),O=ge(),f=J(new Date(new Date().setMonth(new Date().getMonth()-1))),y=J(new Date),s=o(f),d=o(y),j=o(),R=o(),C=o(),x=o(),I=o(),P=o(),ne=B.CODES.TICKET_TYPE,se=B.CODES.COUNSEL_CATEGORY,de=B.CODES.TICKET_PROCESS_STATUS,Y=B.TICKET_TYPE.COUNSEL_TICKET,c=o(),m=o(),i=o(),V=o(O.codes.get(Y)),M=o(null),b=o(null),W=o(K(()=>[{name:"\uC804\uCCB4",value:null},...F.counselTypeArray.map(e=>({name:e.name,value:e}))])),N=o([{name:"\uC804\uCCB4",value:null}]),$=o([{name:"\uC804\uCCB4",value:null}]),T=o(!0),_=o(!1),g=o(!1),h=o(!1),w=o(!1),S=o(!1),D=o(!0),E=o(!1),U=o(!1),ie=o(K(()=>[{name:"\uC804\uCCB4",value:null},...O.codes.get(ne).children])),re=o(K(()=>[{name:"\uC804\uCCB4",value:null},...O.codes.get(de).children])),ce=o(K(()=>[{name:"\uC804\uCCB4",value:null},...O.codes.get(se).children])),X=o({fromCreatedDate:G(f),toCreatedDate:H(y),"entity.typeCode":Y});n(s,e=>{e||(s.value=f)}),n(d,e=>{e||(d.value=y)}),n(T,e=>{e||(s.value=f,d.value=y)}),n(b,e=>{e?_.value=!0:_.value=!1}),n(j,e=>{e?g.value=!0:g.value=!1}),n(C,e=>{e?h.value=!0:h.value=!1}),n(x,e=>{e?w.value=!0:w.value=!1}),n(I,e=>{e?S.value=!0:S.value=!1}),n(V,e=>{e?D.value=!0:D.value=!1}),n(M,e=>{e?U.value=!0:U.value=!1}),n(W,e=>{e.length>0&&!c.value&&(c.value=null)},{immediate:!0}),n(c,e=>{e?(E.value=!0,N.value=[{name:"\uC804\uCCB4",value:null},...F.getChildrenCounselTypesByTopParentCodeValue(e.code).map(l=>({name:l.name,value:l}))],m.value=null,i.value=null):(E.value=!1,N.value=[{name:"\uC804\uCCB4",value:null}],$.value=[{name:"\uC804\uCCB4",value:null}],m.value=null,i.value=null)},{immediate:!0}),n(m,e=>{e?($.value=[{name:"\uC804\uCCB4",value:null},...F.getChildrenCounselTypesByTopParentCodeValue(e.code).map(l=>({name:l.name,value:l}))],i.value=null):($.value=[{name:"\uC804\uCCB4",value:null}],i.value=null)},{immediate:!0});function me(){Q.dialog({component:le,componentProps:{enableRowDblClick:!0}}).onOk(e=>{R.value=`${e.payload[0].name} [${e.payload[0].id}]`,j.value=e.payload[0].entityId})}function ve(){Q.dialog({component:le,componentProps:{enableRowDblClick:!0}}).onOk(e=>{P.value=`${e.payload[0].name} [${e.payload[0].id}]`,I.value=e.payload[0].entityId})}function J(e){const l=new Date(e);let t=""+(l.getMonth()+1),v=""+l.getDate();const k=l.getFullYear();return t.length<2&&(t="0"+t),v.length<2&&(v="0"+v),[k,t,v].join("-")}function G(e){return e+" 00:00:00"}function H(e){const l=new Date(e);l.setDate(l.getDate()+1),l.setHours(0,0,0,0);const t=l.getFullYear(),v=String(l.getMonth()+1).padStart(2,"0"),k=String(l.getDate()).padStart(2,"0"),p=String(l.getHours()).padStart(2,"0"),Ce=String(l.getMinutes()).padStart(2,"0"),xe=String(l.getSeconds()).padStart(2,"0");return`${t}-${v}-${k} ${p}:${Ce}:${xe}`}function pe(){return Math.abs(new Date(d.value)-new Date(s.value))/(1e3*60*60*24)>tl}function z(){if(T.value&&pe()){ee(ol);return}const e={};T.value?(s.value&&(e.fromCreatedDate=G(s.value)),d.value&&(e.toCreatedDate=H(d.value))):(e.fromCreatedDate=G(f),e.toCreatedDate=H(y)),_.value&&b.value&&(e["entity.counselCategoryCode"]=b.value.code),g.value&&j.value&&(e["entity.createdBy"]=j.value),h.value&&C.value.trim()&&(e.entityIds=[C.value.trim()]),w.value&&x.value.trim()&&(e["entity.tel"]=x.value.trim()),S.value&&I.value&&(e["entity.manager.entityId"]=I.value),D.value&&V.value&&(e["entity.typeCode"]=V.value.code),E.value&&(c.value&&(e["entity.counselTypeCodeLarge"]=c.value.code),m.value&&(e["entity.counselTypeCodeMedium"]=m.value.code),i.value&&(e["entity.counselTypeCodeSmall"]=i.value.code)),U.value&&(e["entity.statusCode"]=M.value.code),X.value=e,ue("search",e)}function fe(){T.value=!0,_.value=!1,g.value=!1,h.value=!1,w.value=!1,S.value=!1,D.value=!0,E.value=!1,U.value=!1,s.value=f,d.value=y,b.value=null,R.value=null,j.value=null,C.value=null,x.value=null,P.value=null,I.value=null,V.value=O.codes.get(Y),c.value=null,m.value=null,i.value=null,M.value=null}async function ye(){if(!ae.hasDatas){ee("\uB2E4\uC6B4\uB85C\uB4DC \uBC1B\uC744 \uBAA9\uB85D\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}try{const e=await he.downloadTickets(X.value),l=e.headers["content-disposition"],t=l?l.split("filename=")[1].replace(/['"]/g,""):"TICKET.xlsx",v=new Blob([e.data],{type:"application/vnd.ms-excel"}),k=window.URL.createObjectURL(v),p=document.createElement("a");p.href=k,p.setAttribute("download",t),document.body.appendChild(p),p.click(),p.remove(),window.URL.revokeObjectURL(k)}catch(e){we(e)}}return(e,l)=>(Ve(),be("div",De,[a("div",Ee,[a("div",Ue,[u(r,{modelValue:T.value,"onUpdate:modelValue":l[0]||(l[0]=t=>T.value=t),label:"\uBC1C\uD589\uC77C\uC790"},null,8,["modelValue"])]),a("div",ke,[a("div",qe,[u(A,{class:"text-no-wrap col",type:"date",modelValue:s.value,"onUpdate:modelValue":l[1]||(l[1]=t=>s.value=t),max:d.value},null,8,["modelValue","max"]),u(A,{class:"text-no-wrap col",type:"date",modelValue:d.value,"onUpdate:modelValue":l[2]||(l[2]=t=>d.value=t),min:s.value},null,8,["modelValue","min"])])]),a("div",Ae,[u(r,{modelValue:_.value,"onUpdate:modelValue":l[3]||(l[3]=t=>_.value=t),label:"\uC0C1\uB2F4\uAD6C\uBD84"},null,8,["modelValue"])]),a("div",Oe,[u(q,{options:ce.value,modelValue:b.value,"onUpdate:modelValue":l[4]||(l[4]=t=>b.value=t),"option-label":"name"},null,8,["options","modelValue"])]),a("div",je,[u(r,{modelValue:g.value,"onUpdate:modelValue":l[5]||(l[5]=t=>g.value=t),label:"\uBCF4\uACE0\uC790"},null,8,["modelValue"])]),a("div",Ie,[a("div",Me,[u(A,{modelValue:R.value,"onUpdate:modelValue":l[6]||(l[6]=t=>R.value=t),readonly:!0},null,8,["modelValue"]),u(L,{icon:"search",class:"q-ml-xs",onClick:me})])])]),a("div",Le,[a("div",Re,[u(r,{modelValue:h.value,"onUpdate:modelValue":l[7]||(l[7]=t=>h.value=t),label:"\uD2F0\uCF13\uBC88\uD638"},null,8,["modelValue"])]),a("div",Pe,[u(A,{modelValue:C.value,"onUpdate:modelValue":l[8]||(l[8]=t=>C.value=t),onKeyup:Z(z,["enter"])},null,8,["modelValue"])]),a("div",$e,[u(r,{modelValue:w.value,"onUpdate:modelValue":l[9]||(l[9]=t=>w.value=t),label:"\uC804\uD654\uBC88\uD638"},null,8,["modelValue"])]),a("div",Ke,[u(A,{modelValue:x.value,"onUpdate:modelValue":l[10]||(l[10]=t=>x.value=t),onKeyup:Z(z,["enter"])},null,8,["modelValue"])]),a("div",Be,[u(r,{modelValue:S.value,"onUpdate:modelValue":l[11]||(l[11]=t=>S.value=t),label:"\uB2F4\uB2F9\uC790"},null,8,["modelValue"])]),a("div",Fe,[a("div",Ye,[u(A,{modelValue:P.value,"onUpdate:modelValue":l[12]||(l[12]=t=>P.value=t),readonly:!0},null,8,["modelValue"]),u(L,{icon:"search",class:"q-ml-xs",onClick:ve})])])]),a("div",Ne,[a("div",Ge,[u(r,{modelValue:D.value,"onUpdate:modelValue":l[13]||(l[13]=t=>D.value=t),label:"\uD2F0\uCF13\uC720\uD615"},null,8,["modelValue"])]),a("div",He,[u(q,{options:ie.value,modelValue:V.value,"onUpdate:modelValue":l[14]||(l[14]=t=>V.value=t),"option-label":"name"},null,8,["options","modelValue"])]),a("div",ze,[u(r,{modelValue:E.value,"onUpdate:modelValue":l[15]||(l[15]=t=>E.value=t),label:"\uC0C1\uB2F4\uC720\uD615"},null,8,["modelValue"])]),a("div",Qe,[a("div",We,[u(q,{class:"col",options:W.value,modelValue:c.value,"onUpdate:modelValue":l[16]||(l[16]=t=>c.value=t),"option-label":"name"},null,8,["options","modelValue"]),u(q,{class:"col",options:N.value,modelValue:m.value,"onUpdate:modelValue":l[17]||(l[17]=t=>m.value=t),"option-label":"name"},null,8,["options","modelValue"]),u(q,{class:"col",options:$.value,modelValue:i.value,"onUpdate:modelValue":l[18]||(l[18]=t=>i.value=t),"option-label":"name"},null,8,["options","modelValue"])])]),a("div",Xe,[u(r,{modelValue:U.value,"onUpdate:modelValue":l[19]||(l[19]=t=>U.value=t),label:"\uCC98\uB9AC\uC0C1\uD0DC"},null,8,["modelValue"])]),a("div",Je,[a("div",Ze,[a("div",el,[u(q,{options:re.value,modelValue:M.value,"onUpdate:modelValue":l[20]||(l[20]=t=>M.value=t),"option-label":"name"},null,8,["options","modelValue"])]),a("div",ll,[u(L,{label:"\uC870\uD68C",onClick:z}),u(L,{label:"Excel",class:"q-ml-xs",onClick:ye}),u(L,{label:"\uCD08\uAE30\uD654",class:"q-ml-xs",onClick:fe})])])])])]))}},Rl=Se(al,[["__scopeId","data-v-24eb68c2"]]);export{Rl as default};
