import{Q as C}from"./QBadge.c1f4e948.js";import{r as a,g as y,t as I,o as q,Y as V,z as l,a as r,w as A,a0 as f,Z as W}from"./index.02f7c95d.js";/* empty css                                                                  */import{_ as $}from"./_plugin-vue_export-helper.cdc0426e.js";import B from"./AInput.398f059b.js";import D from"./ABtn.e24d7e8a.js";import{u as F}from"./utils.32a0767f.js";import{s as _}from"./scriptApi.ab757ee5.js";import{h as g}from"./errorHandler.5efe1eb1.js";import{u as Q}from"./counselTypeStore.5faa86f9.js";import{s as u}from"./dialog.88ce899f.js";import z from"./ATextEditor.d38287bf.js";import{u as G}from"./permissionStore.29c18612.js";import{F as P}from"./FlowRoleCode.12cdb02e.js";import H from"./ALoadingSpinner.ca275fb8.js";/* empty css                                                             */import"./axios.816e1a60.js";import"./header.10137493.js";import"./authStore.fadf8446.js";import"./counsel-hub.145170b4.js";import"./CommonPopup.2b0ee10b.js";import"./use-dialog-plugin-component.234e0905.js";import"./permissionApi.ffe0b82d.js";const Y={class:"column fit"},Z={class:"col-auto row fixed-height full-width"},J={class:"col top-border-right justify-center column q-px-xs"},K={class:"col-auto row fixed-height full-width"},M={class:"col-auto t-column text-left body-border-left q-px-xs column justify-center full-height"},X={class:"row"},tt={class:"col body-border-right q-pa-xs no-wrap text-no-wrap full-height justify-center column"},et={class:"col row full-width"},ot={class:"col-auto t-column text-left body-border-left q-px-xs column justify-center full-height"},lt={class:"row"},st={class:"col body-border-right q-pa-xs no-wrap text-no-wrap full-height"},nt={key:0,class:"col-auto full-width text-right bg-grey-5 a-border q-pa-xs"},at={__name:"ScriptBoard",props:["counselType"],setup(R){const m=a(!1),E=R,v=Q(),x=G(),c=a(),p=a(),N=y(()=>x.hasPermission(P.SCRIPT_ROLE.READ)),j=y(()=>x.hasPermission(P.SCRIPT_ROLE.SAVE)),s=a(),h=a(),i=a(),w=y(()=>F.removeHtmlTagsIncludingImg(i.value)),d=a();I(()=>E.counselType,e=>{e?(p.value=e.entityId,O(e.path)):(p.value=null,c.value=null)},{deep:!0}),I(p,e=>{e?k(e):S()},{immediate:!0});function O(e){var n,b,T;if(!e){c.value=null;return}let t=e.split("."),o="";t.length>0&&(o=(n=v.counselTypes.get(t[0]))==null?void 0:n.name),t.length>1&&(o+=` > ${(b=v.counselTypes.get(t[1]))==null?void 0:b.name}`),t.length>2&&(o+=` > ${(T=v.counselTypes.get(t[2]))==null?void 0:T.name}`),c.value=o}function S(){s.value=null,h.value=null,d.value=null}function k(e){if(!N.value){u("\uC2A4\uD06C\uB9BD\uD2B8 \uC870\uD68C \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}if(!e)return;m.value=!0;const t={};t["entity.counselType.entityId"]=e,_.getScript(t).then(o=>{if(o.status===200)if(o.data.length){const n=o.data[0];s.value=n.title,h.value=n.contents,i.value=n.contents,d.value=n.entityId}else S()}).catch(o=>{g(o)}).finally(()=>{m.value=!1})}function L(){if(p.value){if(!s.value){u("\uC81C\uBAA9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.");return}if(!i.value){u("\uB0B4\uC6A9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.");return}if(d.value){const e={entity:{title:s.value,contents:i.value,rawContent:w.value}};_.updateScript(d.value,e).then(t=>{t.status===200&&u("\uC218\uC815\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}).catch(t=>{g(t)})}else{const e={entity:{counselType:{entityId:p.value},title:s.value,contents:i.value,rawContent:w.value}};_.saveScript(e).then(t=>{t.status===200&&(u("\uC800\uC7A5\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),d.value=t.data.entityId)}).catch(t=>{g(t)})}}else u("\uC0C1\uB2F4\uC720\uD615\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694.")}function U(e){i.value=e}return(e,t)=>(q(),V("div",Y,[l("div",Z,[t[3]||(t[3]=l("div",{class:"col-auto t-column text-left top-border-left q-px-xs column justify-center"},"\uC0C1\uB2F4\uC720\uD615",-1)),l("div",J,[r(B,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=o=>c.value=o),readonly:""},null,8,["modelValue"])])]),l("div",K,[l("div",M,[l("div",X,[r(C,{class:"q-pa-none q-mr-xs",color:"grey-2","text-color":"red"},{default:A(()=>t[4]||(t[4]=[f("*")])),_:1}),t[5]||(t[5]=f("\uC81C\uBAA9"))])]),l("div",tt,[r(B,{modelValue:s.value,"onUpdate:modelValue":t[1]||(t[1]=o=>s.value=o)},null,8,["modelValue"])])]),l("div",et,[l("div",ot,[l("div",lt,[r(C,{class:"q-pa-none q-mr-xs",color:"grey-2","text-color":"red"},{default:A(()=>t[6]||(t[6]=[f("*")])),_:1}),t[7]||(t[7]=f("\uB0B4\uC6A9"))])]),l("div",st,[r(z,{class:"col fit no-wrap","content-input":h.value,onContentOutput:U},null,8,["content-input"])])]),j.value?(q(),V("div",nt,[r(D,{label:"\uC800\uC7A5",class:"q-ml-xs",onClick:L})])):W("",!0),r(H,{modelValue:m.value,"onUpdate:modelValue":t[2]||(t[2]=o=>m.value=o)},null,8,["modelValue"])]))}},Bt=$(at,[["__scopeId","data-v-8e96217b"]]);export{Bt as default};
