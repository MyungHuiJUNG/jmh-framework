import{g as Ie,r as u,t as ae,y as Se,o as be,Y as Ve,z as n,a as s,B as ne}from"./index.02f7c95d.js";import ue from"./AInput.398f059b.js";import oe from"./ABtn.e24d7e8a.js";import re from"./ACheckbox.923db872.js";import J from"./TreeDepth.d1ea8d25.js";import Oe from"./TreeDataList.26c5b605.js";import{u as xe,o as A}from"./organizationStore.a86bd6ff.js";import{u as Ne}from"./permissionStore.29c18612.js";import{s as h,a as ke}from"./dialog.88ce899f.js";import{h as v}from"./errorHandler.5efe1eb1.js";import{F as Ce}from"./FlowRoleCode.12cdb02e.js";import{_ as Ee}from"./_plugin-vue_export-helper.cdc0426e.js";/* empty css                                                             */import"./TabulatorGrid.9c80b09d.js";import"./ATitleBar.bbf1d9a4.js";import"./ClosePopup.daa62b28.js";import"./QTree.ce7bbb93.js";import"./QSlideTransition.b1b1fe3f.js";import"./QTooltip.86ca1c0e.js";import"./position-engine.53490cc8.js";import"./axios.816e1a60.js";import"./header.10137493.js";import"./permissionApi.ffe0b82d.js";import"./CommonPopup.2b0ee10b.js";import"./use-dialog-plugin-component.234e0905.js";import"./authStore.fadf8446.js";import"./counsel-hub.145170b4.js";const Ge={class:"a-border q-pa-xs fit column",style:{"min-height":"680px"}},qe={class:"col-auto"},Ae={class:"full-width a-table"},Te={class:"row"},Fe={class:"row"},Ue={class:"row"},ze={class:"row justify-between"},Be={class:"col-auto"},Me={class:"row col q-mt-xs"},Pe={class:"a-border full-height col-2 q-pa-xs"},je={class:"a-border full-height col q-ml-xs q-pa-xs"},Ke={class:"a-border full-height col q-ml-xs q-pa-xs"},We={class:"a-border full-height col q-ml-xs q-pa-xs"},Je={__name:"OrgManage",setup(Le){const se=[{title:"\uC870\uC9C1\uBA85",field:"name"}],N=xe(),ie=Ne(),r=Ie(()=>ie.hasPermission(Ce.ORGANIZATION_ROLE.READ)),b=u(!1),V=u(!1),m=u(null),g=u(null),y=u([]),k=u([]),i=u([]),O=u([]),D=u([]),L=u(null),c=u({entityId:null,code:null}),_=u({entityId:null,code:null}),$=u({entityId:null,code:null}),ce=u(null),C=u(null),Y=u(null),Z=u(null),E=u(null),p=u(null),I=u(null);ae(()=>m.value,l=>{l?b.value=!0:b.value=!1}),ae(()=>g.value,l=>{l?V.value=!0:V.value=!1}),Se(()=>{x()});const T=u();function F(){const l={};b.value&&m.value&&(l.name=m.value),V.value&&g.value&&(l.code=g.value),T.value=l}function de(){m.value=null,g.value=null,T.value=null}function U(){i.value=[],O.value=[],D.value=[]}function ve(l){if(!l){x();return}L.value=l;const e=L.value.split(".");e.length?E.value=e[0]:E.value=null,e.length>1?p.value=e[1]:p.value=null,e.length>2?I.value=e[2]:I.value=null,e.length&&C.value.selectRow(E.value)}function z(){E.value=null,p.value=null,I.value=null}function H(l){return l.map(e=>(e.children&&!e.children.length&&delete e.children,e.children&&(e.children=H(e.children)),e))}function f(l){return l.map(e=>{var d;const t={...e,id:e.code};return(d=t.children)!=null&&d.length&&(t.children=f(t.children)),t})}function B(l){const t=[{entityId:"",name:"\uC804\uCCB4",code:"",path:null,orderNumber:0,children:JSON.parse(JSON.stringify(l))}];return H(t),f(t)}function S(l){return l.map(e=>{var t;return(t=e.children)!=null&&t.length&&(e.children=S(e.children)),e}).sort((e,t)=>e.orderNumber-t.orderNumber)}function x(){r.value?A.getOrg().then(l=>{const e=S(l.data);k.value=B(e),y.value=f(e),U(),i.value=y.value}).catch(l=>{v(l)}):h("\uC870\uC9C1 \uC870\uD68C \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.")}function Q(l){return A.getOrg(l).then(e=>e.data).catch(e=>{v(e)})}function M(){A.getOrg().then(l=>{if(l.status===200){const e=S(l.data);k.value=B(e),y.value=f(e),U(),i.value=y.value,c.value.code&&C.value.selectRow(c.value.code)}}).catch(l=>{v(l)})}function P(){A.getOrg().then(l=>{if(l.status===200){const e=S(l.data);k.value=B(e),y.value=f(e),U(),i.value=y.value,c.value.code&&C.value.selectRow(c.value.code),p.value=_.value.code}}).catch(l=>{v(l)})}async function j({depth:l,entityId:e}){if(!e){h("\uC0AD\uC81C\uD560 \uD56D\uBAA9\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694");return}await ke("\uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")&&N.remove(e).then(d=>{d.status===200&&(r.value&&l===1?x():r.value&&l===2?M():r.value&&l===3?P():i.value=[])}).catch(d=>{v(d)})}function he(l){j({depth:1,entityId:l})}function pe(l){j({depth:2,entityId:l})}function fe(l){j({depth:3,entityId:l})}function me(l){O.value=[],D.value=[],l.entityId&&Q(l.entityId).then(e=>{O.value=S(f(e.children)),p.value&&Y.value.selectRow(p.value),p.value=null}).catch(e=>{v(e)})}function ge(l){D.value=[],l.entityId&&Q(l.entityId).then(e=>{D.value=S(f(e.children)),I.value&&Z.value.selectRow(I.value),I.value=null}).catch(e=>{v(e)})}function ye({newRows:l,modifiedRows:e}){K({depth:1,newRows:l,modifiedRows:e})}function De({newRows:l,modifiedRows:e}){K({depth:2,newRows:l,modifiedRows:e})}function _e({newRows:l,modifiedRows:e}){K({depth:3,newRows:l,modifiedRows:e})}function K({depth:l,newRows:e,modifiedRows:t}){var w,ee;if(!(e!=null&&e.length)&&!(t!=null&&t.length))return;const d=a=>a.some(o=>!o.code||o.code.toString().trim()===""||!o.name||o.name.toString().trim()==="");if((e==null?void 0:e.length)&&d(e)||(t==null?void 0:t.length)&&d(t)){h("\uBE48 \uD56D\uBAA9\uC774 \uC788\uC2B5\uB2C8\uB2E4.");return}const X=a=>a.some(o=>o.code.includes("."));if((e==null?void 0:e.length)&&X(e)||(t==null?void 0:t.length)&&X(t)){h("\uCF54\uB4DC\uBA85\uC5D0 .\uC744 \uD3EC\uD568\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");return}let W=null,G=null;if(l===2){if(!((w=c.value)!=null&&w.entityId)){h("\uC0C1\uC704\uC720\uD615\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694.");return}W=c.value.entityId,G=O.value}else if(l===3){if(!((ee=_.value)!=null&&ee.entityId)){h("\uC0C1\uC704\uC720\uD615\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694.");return}W=_.value.entityId,G=D.value}else G=i.value;const R=e.map((a,o)=>{var te;const le={code:a.code,name:a.name,orderNumber:(te=a.orderNumber)!=null?te:G.length+1+o};return l>1&&(le.parent={entityId:W}),le}),q=t.map(a=>{const o={entityId:a.entityId,code:a.code,name:a.name,orderNumber:a.orderNumber};return l>1&&(o.parent={entityId:a.parentEntityId}),o});R.length?N.save(R).then(a=>a.status===200&&q.length?N.update(q):null).then(a=>{(a===null||a&&a.status===200)&&(r.value&&l===1?x():r.value&&l===2?M():r.value&&l===3?P():i.value=[],h("\uC800\uC7A5\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4"))}).catch(a=>{v(a)}):q.length&&N.update(q).then(a=>{a.status===200&&(r.value&&l===1?x():r.value&&l===2?M():r.value&&l===3?P():i.value=[],h("\uC800\uC7A5\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4"))}).catch(a=>{v(a)})}return(l,e)=>(be(),Ve("div",Ge,[n("div",qe,[n("table",Ae,[e[7]||(e[7]=n("colgroup",null,[n("col",{class:"t-column",width:"100px"}),n("col"),n("col",{class:"t-column",width:"100px"}),n("col")],-1)),n("tbody",null,[n("tr",null,[n("td",null,[n("div",Te,[s(re,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=t=>b.value=t),label:"\uC870\uC9C1\uBA85"},null,8,["modelValue"])])]),n("td",null,[n("div",Fe,[s(ue,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t),onKeyup:ne(F,["enter"])},null,8,["modelValue"])])]),n("td",null,[n("div",Ue,[s(re,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=t=>V.value=t),label:"\uCF54\uB4DC"},null,8,["modelValue"])])]),n("td",null,[n("div",ze,[n("div",null,[s(ue,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=t=>g.value=t),onKeyup:ne(F,["enter"])},null,8,["modelValue"])]),n("div",Be,[s(oe,{label:"\uC870\uD68C",onClick:F}),s(oe,{label:"\uCD08\uAE30\uD654",class:"q-ml-xs",onClick:de})])])])])])])]),n("div",Me,[n("div",Pe,[s(Oe,{data:k.value,columns:se,onRowClick:ve,ref_key:"treeGrid",ref:ce,filter:T.value},null,8,["data","filter"])]),n("div",je,[s(J,{ref_key:"firstDepthGrid",ref:C,data:i.value,title:"\uC870\uC9C1(1depth)","type-name":"\uC870\uC9C1\uBA85","is-top":!0,onDeleteRow:he,onSaveRows:ye,onRowSelected:me,onRowClick:z,modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=t=>c.value=t),viewType:"organization"},null,8,["data","modelValue"])]),n("div",Ke,[s(J,{ref_key:"secondDepthGrid",ref:Y,data:O.value,title:"\uC870\uC9C1(2depth)","type-name":"\uC870\uC9C1\uBA85","parent-entity":c.value,onRowSelected:ge,onDeleteRow:pe,onSaveRows:De,onRowClick:z,modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=t=>_.value=t),viewType:"organization"},null,8,["data","parent-entity","modelValue"])]),n("div",We,[s(J,{ref_key:"thirdDepthGrid",ref:Z,data:D.value,title:"\uC870\uC9C1(3depth)","type-name":"\uC870\uC9C1\uBA85","parent-entity":_.value,onDeleteRow:fe,onSaveRows:_e,onRowClick:z,modelValue:$.value,"onUpdate:modelValue":e[6]||(e[6]=t=>$.value=t),viewType:"organization"},null,8,["data","parent-entity","modelValue"])])])]))}},Dl=Ee(Je,[["__scopeId","data-v-03fbd3a1"]]);export{Dl as default};
