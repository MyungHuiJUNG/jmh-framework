import{r,g as P,t as H,y as oe,o as S,Y as le,z as a,a as s,B as re,c as M,Z as N}from"./index.02f7c95d.js";import{B as ie,b as y}from"./BoardCategory.e55ffcf3.js";import ne from"./ATitleBar.bbf1d9a4.js";import L from"./AInput.398f059b.js";import A from"./ABtn.e24d7e8a.js";import F from"./ACheckbox.923db872.js";import se from"./TabulatorGrid.9c80b09d.js";import ue from"./BoardDetailPopup.469696a2.js";import ce from"./BoardRegistPopup.74d95955.js";import{u as de}from"./BoardCatagoryManagePopup.4c280645.js";import{u as me}from"./permissionStore.29c18612.js";import{u as ve}from"./use-quasar.2d4ce40a.js";import{s as z,a as fe}from"./dialog.88ce899f.js";import{h as _}from"./errorHandler.5efe1eb1.js";import{F as V}from"./FlowRoleCode.12cdb02e.js";import pe from"./UserPopup.4dc2e487.js";import{_ as ge}from"./_plugin-vue_export-helper.cdc0426e.js";import"./QTree.ce7bbb93.js";import"./QSlideTransition.b1b1fe3f.js";import"./QTooltip.86ca1c0e.js";import"./position-engine.53490cc8.js";import"./axios.816e1a60.js";import"./header.10137493.js";import"./app-util.f29d8347.js";import"./ClosePopup.daa62b28.js";/* empty css                                                             */import"./QBadge.c1f4e948.js";import"./FileUploadManage.e1cb862f.js";import"./CommonPopup.2b0ee10b.js";import"./use-dialog-plugin-component.234e0905.js";import"./BoardCategoryRegist.79478ab1.js";import"./utils.32a0767f.js";import"./ATextEditor.d38287bf.js";import"./BoardCategoryMovePopup.1a199b96.js";import"./permissionApi.ffe0b82d.js";import"./authStore.fadf8446.js";import"./counsel-hub.145170b4.js";import"./ASelect.a02a29e0.js";import"./QItem.1bce08e7.js";import"./QSelect.b17c746f.js";import"./QMenu.3c9cf304.js";import"./rtl.276c3f1b.js";import"./format.2cae61da.js";import"./organizationStore.a86bd6ff.js";import"./userApi.abe7b8c8.js";import"./ALoadingSpinner.ca275fb8.js";const he={class:"a-border q-pa-xs fit column"},ye={class:"col row"},_e={class:"col-2 a-border full-height q-pa-xs"},we={class:"col column full-height q-ml-xs"},Be={class:"col-auto q-mb-xs full-width"},be={class:"a-table full-width"},Ae={class:"row"},Ce={class:"row"},Re={class:"row"},xe={class:"row justify-between"},ke={class:"row"},ze={class:"col-auto"},Ie={class:"column col no-wrap a-border q-pa-xs full-width"},De={class:"full-width text-right bg-grey-5 a-border q-pa-xs col-auto"},Pe="/rest/api/v1/board/boards",Se={__name:"BoardMain",setup(Ve){const I=ve(),q=de(),D=me(),c=r(!1),U=P(()=>D.hasPermission(V.BOARD_ROLE.READ)),T=P(()=>D.hasPermission(V.BOARD_ROLE.ADD)),K=P(()=>D.hasPermission(V.BOARD_ROLE.DELETE)),d=r(""),f=r(!1),p=r(!1),g=r(),C=r(),i=r(""),w=r([]),E=r(""),h=r([]),G=[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerHozAlign:"center",headerSort:!1,width:20},{title:"entityId",field:"entityId",visible:!1},{title:"#",formatter:"rownum",headerHozAlign:"center",hozAlign:"center",headerSort:!1,width:60},{title:"\uCE74\uD14C\uACE0\uB9AC",field:"categories",formatter:function(e){let t=e.getData();return!t.category||!t.category.path?"\uC804\uCCB4":t.category.path.split(".").map(u=>{const n=q.categories.get(u);return n?n.name:u}).join(" > ")},headerHozAlign:"center",hozAlign:"left",headerSort:!0},{title:"\uC81C\uBAA9",field:"title",headerHozAlign:"center",hozAlign:"left",headerSort:!0},{title:"\uB4F1\uB85D\uC790",field:"createdBy",formatter:function(e){let t=e.getData();return t.createdByUser.name+` [${t.createdByUser.id}]`},hozAlign:"center",headerHozAlign:"center",headerSort:!0,width:150},{title:"\uB4F1\uB85D\uC77C\uC790",field:"createdDate",headerHozAlign:"center",hozAlign:"center",headerSort:!0,width:150},{title:"\uC870\uD68C\uC218",field:"readCount",headerHozAlign:"center",hozAlign:"center",headerSort:!0,width:100}],m=r(0),R=r(100),x=r(!1),o=r({}),O=r(null);H(d,e=>{e?f.value=!0:f.value=!1}),H(g,e=>{e?p.value=!0:p.value=!1});function $(e){h.value=e}function j(){if(!U.value){z("\uAC8C\uC2DC\uD310 \uC870\uD68C \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}c.value?(o.value={},i.value&&(o.value["entity.categoryId"]=i.value.entityId),f.value&&d.value.trim()&&(o.value.keyword=d.value.trim()),p.value&&g.value&&(o.value["entity.createdByUser"]=g.value),b()):(m.value=0,o.value={page:m.value,size:R.value},i.value&&(o.value["entity.categoryId"]=i.value.entityId),f.value&&d.value.trim()&&(o.value.keyword=d.value.trim()),p.value&&g.value&&(o.value["entity.createdByUser"]=g.value),y.getBoards(o.value).then(e=>{e.status===200&&(w.value=e.data.content,x.value=e.data.last,m.value+=1)}).catch(e=>{_(e)}))}function B(){if(!U.value){z("\uAC8C\uC2DC\uD310 \uC870\uD68C \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}c.value?(o.value={},i.value&&(o.value["entity.categoryId"]=i.value.entityId)):(m.value=0,o.value={page:m.value,size:R.value},i.value&&(o.value["entity.categoryId"]=i.value.entityId),y.getBoards(o.value).then(e=>{e.status===200&&(w.value=e.data.content,x.value=e.data.last,m.value+=1)}).catch(e=>{_(e)}))}async function Q(){if(!c.value&&!x.value){o.value={...o.value,page:m.value};try{const e=await y.getBoards(o.value);e.status===200&&(w.value=[...w.value,...e.data.content],x.value=e.data.last,m.value+=1)}catch(e){_(e)}}}function Y(e){i.value=e,B(),c.value&&b(),h.value=[]}function Z(){if(!h.value.length){z("\uC0AD\uC81C\uD560 \uAC8C\uC2DC\uBB3C\uC744 \uC120\uD0DD\uD558\uC138\uC694.");return}let e="";for(const t in h.value)t>0&&(e+=","),e+=h.value[t].entityId;fe("\uC120\uD0DD\uD55C \uAC8C\uC2DC\uAE00\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?").then(t=>{t&&y.deleteBoards(e).then(l=>{l.status===200&&(h.value=[],B(),c.value&&b(),k())}).catch(l=>{_(l)})})}function J(){var t;const e=(t=i.value)!=null&&t.entityId?{categoryId:i.value.entityId}:null;I.dialog({component:ce,componentProps:e?{propCategoryData:e}:{}}).onOk(()=>{B(),c.value&&b(),k()})}function W(e){const t={entityId:e.entityId};I.dialog({component:ue,componentProps:{propData:t}}).onOk(v=>{let u="";v.type==="delete"&&(u="\uC0AD\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),v.type==="update"&&(u="\uC218\uC815 \uC800\uC7A5\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),u&&(z(u),B(),c.value&&b(),k())});const l={readCount:e.readCount+1};y.updateBoard(t.entityId,l).then(v=>{e.readCount++}).catch(v=>{_(v)})}function X(){d.value=null,f.value=!1,C.value=null,g.value=null,p.value=!1}function k(){O.value.getAllCategories()}function ee(){I.dialog({component:pe,componentProps:{enableRowDblClick:!0}}).onOk(e=>{g.value=e.payload[0].entityId,C.value=`${e.payload[0].name} [${e.payload[0].id}]`})}oe(()=>{B(),k(),q.load()});function b(){E.value.setData()}function te(e,t,l){return o.value={...o.value,page:l.page-1,size:l.size||R.value,isPaging:!0},new Promise(function(v,u){y.getBoards(o.value).then(n=>{if(n.status===200){const ae={data:n.data.content,last_page:n.data.totalPages,last_row:n.data.totalElements};v(ae)}}).catch(n=>{_(n),u(n)})})}return(e,t)=>(S(),le("div",he,[a("div",ye,[a("div",_e,[s(ie,{addAdjustTreeButton:!0,addCategoryManageComponent:!0,onRowClick:Y,ref_key:"categoryRef",ref:O},null,512)]),a("div",we,[a("div",Be,[a("table",be,[t[5]||(t[5]=a("colgroup",null,[a("col",{class:"t-column",width:"120px"}),a("col"),a("col",{class:"t-column",width:"100px"}),a("col")],-1)),a("tbody",null,[a("tr",null,[a("td",null,[a("div",Ae,[s(F,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=l=>f.value=l),label:"\uC81C\uBAA9 + \uB0B4\uC6A9"},null,8,["modelValue"])])]),a("td",null,[a("div",Ce,[s(L,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=l=>d.value=l),onKeyup:t[2]||(t[2]=re(l=>j(),["enter"]))},null,8,["modelValue"])])]),a("td",null,[a("div",Re,[s(F,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=l=>p.value=l),label:"\uB4F1\uB85D\uC790"},null,8,["modelValue"])])]),a("td",null,[a("div",xe,[a("div",ke,[s(L,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=l=>C.value=l),readonly:!0},null,8,["modelValue"]),s(A,{icon:"search",class:"q-ml-xs",onClick:ee})]),a("div",ze,[s(A,{label:"\uC870\uD68C",onClick:j}),s(A,{label:"\uCD08\uAE30\uD654",class:"q-ml-xs",onClick:X})])])])])])])]),a("div",Ie,[s(ne,{title:"\uAC8C\uC2DC\uD310 \uBAA9\uB85D",class:"col-auto full-width q-mb-xs"}),s(se,{ref_key:"grid",ref:E,rows:w.value,columns:G,selectableRows:!0,"infinite-scroll":Q,selectableRowsRangeMode:"click",onRowSelected:$,onRowDeselected:$,onRowDblClick:W,"ajax-url":Pe,"ajax-request-func":te,pagination:c.value,"pagination-size":R.value,class:"col full-width"},null,8,["rows","pagination","pagination-size"]),a("div",De,[K.value?(S(),M(A,{key:0,label:"\uC0AD\uC81C",onClick:Z})):N("",!0),T.value?(S(),M(A,{key:1,label:"\uB4F1\uB85D",class:"q-ml-xs",onClick:J})):N("",!0)])])])])]))}},xt=ge(Se,[["__scopeId","data-v-4787a715"]]);export{xt as default};
