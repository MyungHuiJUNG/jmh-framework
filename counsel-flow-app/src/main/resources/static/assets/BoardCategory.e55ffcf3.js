import{Q as G}from"./QTree.ce7bbb93.js";import{Q as R}from"./QTooltip.86ca1c0e.js";import{u as J}from"./use-quasar.2d4ce40a.js";import{c as Y,B as L}from"./BoardCatagoryManagePopup.4c280645.js";import{api as n}from"./axios.816e1a60.js";import{g as s}from"./header.10137493.js";import{A as H}from"./app-util.f29d8347.js";import y from"./ABtn.e24d7e8a.js";import{u as Z}from"./permissionStore.29c18612.js";import{s as K}from"./dialog.88ce899f.js";import{h as O}from"./errorHandler.5efe1eb1.js";import{F as X}from"./FlowRoleCode.12cdb02e.js";import{_ as ee}from"./_plugin-vue_export-helper.cdc0426e.js";import{r as l,g as D,t as te,R as oe,y as ae,o as c,Y as S,z as re,a as _,c as g,w as h,a0 as j,Z as p}from"./index.02f7c95d.js";const ne=t=>{const r={...t,sort:"createdDate,desc"};return n.get("/rest/api/v1/board/boards",{params:r,...s()})},se=t=>{const r={...t,sort:"createdDate,desc"};return n.get("/rest/api/v1/board/boards/totalCount",{params:r,...s()})},de=t=>n.get(`/rest/api/v1/board/boards/${t}`,{...s()}),le=t=>n.post("/rest/api/v1/board/boards",H.convertObjectToEntityUrlParam(t),{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"date-format":"yyyy-MM-dd HH:mm:ss","Content-Type":"application/x-www-form-urlencoded"}}),ce=(t,r)=>n.put(`/rest/api/v1/board/boards/${t}`,H.convertObjectToEntityUrlParam(r),{...s()}),ie=t=>n.delete(`/rest/api/v1/board/boards/${t}`,{...s()}),ue=t=>{const r={entityIds:t};return n.delete("/rest/api/v1/board/boards",{params:r,...s()})},pe=t=>{const r={};return r["entity.board.entityId"]=t,n.get("/rest/api/v1/board/replies",{...s("yyyy-MM-dd HH:mm:ss"),params:{...r,sort:"createdDate,desc"}})},me=t=>{const r={...s("yyyy-MM-dd HH:mm:ss").headers,"Content-Type":"application/x-www-form-urlencoded"};return n.post("/rest/api/v1/board/replies",t,{headers:r})},fe=(t,r)=>{const C={...s("yyyy-MM-dd HH:mm:ss").headers,"Content-Type":"application/x-www-form-urlencoded"};return n.put(`/rest/api/v1/board/replies/${r}`,t,{headers:C})},ye=t=>n.delete(`/rest/api/v1/board/replies/${t}`,{...s()}),ge={getBoard:de,getBoards:ne,addBoard:le,getBoardsTotalCount:se,updateBoard:ce,deleteBoard:ie,deleteBoards:ue,getReply:pe,addReply:me,updateReply:fe,removeReply:ye};const he={class:"fit column no-wrap"},Ce={class:"col full-width"},ve={key:0,class:"bg-grey-5 q-pa-xs col-auto justify-end row no-wrap"},be={__name:"BoardCategory",props:{addAdjustTreeButton:{type:Boolean,defalut:!1},addChooseButton:{type:Boolean,defalut:!1},addCategoryManageComponent:{type:Boolean,defalut:!1}},emits:["rowClick","chooseCategory"],setup(t,{expose:r,emit:C}){const P=J(),$=Z(),v=t,b=C;r({getAllCategories:u});let i=!1;const m=l(null),B=l(""),w=l([]),k=l(""),A=l([]),f=l(""),E=D(()=>$.hasPermission(X.BOARD_ROLE.CATEGORY_MANAGE)),I=D(()=>!v.addAdjustTreeButton&&!v.addChooseButton&&!v.addCategoryManageComponent);function q(){m.value.collapseAll()}function Q(){m.value.expandAll()}function U(){if(!f.value){K("\uCE74\uD14C\uACE0\uB9AC\uB97C \uC120\uD0DD\uD558\uC138\uC694.");return}b("chooseCategory",f.value)}function F(){if(!i){i=!0;try{V()}finally{i=!1}}}function V(){return new Promise(()=>{P.dialog({component:L}).onOk(()=>{u().then(()=>{const a=x(f.value,B.value);b("rowClick",a)})}).onCancel(()=>{i=!1,u()}).onDismiss(()=>{i=!1,u()})})}function z(a){f.value=a;const e=x(a,B.value);b("rowClick",e)}function x(a,e){for(const o of e){if(o.entityId===a)return o;if(o.children){const d=x(a,o.children);if(d)return d}}return null}function T(a){return a.map(e=>(e.displayName=`${e.name} (${e.boardCount})`,e.children&&!e.children.length&&delete e.children,e.children&&(e.children=T(e.children)),e))}function M(a){return a.map(e=>{var d;const o={...e,id:e.code};return(d=o.children)!=null&&d.length&&(o.children=M(o.children)),o})}function W(a,e){const o=JSON.parse(JSON.stringify(a)),d=[{entityId:"",name:"\uC804\uCCB4",code:"",boardCount:e||0,path:null,orderNumber:0,children:o}];return T(d),M(d)}function N(a){return a.map(e=>{var o;return(o=e.children)!=null&&o.length&&(e.children=N(e.children)),e}).sort((e,o)=>e.orderNumber-o.orderNumber)}async function u(){await Y.getCategory().then(async a=>{await ge.getBoardsTotalCount().then(e=>{B.value=a.data;const o=N(a.data);w.value=W(o,e.data)}).catch(e=>{O(e)})}).catch(a=>{O(a)})}return te(w,()=>{oe(()=>{m.value.expandAll()})}),ae(()=>{u()}),(a,e)=>(c(),S("div",he,[re("div",Ce,[_(G,{ref_key:"qtree",ref:m,"default-expand-all":"","no-transition":"",nodes:w.value,"node-key":"entityId","label-key":"displayName","selected-color":"primary",selected:k.value,"onUpdate:selected":[e[0]||(e[0]=o=>k.value=o),z],expanded:A.value,"onUpdate:expanded":e[1]||(e[1]=o=>A.value=o),"no-nodes-label":"\uBAA9\uB85D\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.",class:"fit"},null,8,["nodes","selected","expanded"])]),I.value?p("",!0):(c(),S("div",ve,[t.addAdjustTreeButton?(c(),g(y,{key:0,icon:"list",onClick:q},{default:h(()=>[_(R,{anchor:"top middle",self:"bottom middle"},{default:h(()=>e[2]||(e[2]=[j("\uBAA8\uB450\uC811\uAE30")])),_:1})]),_:1})):p("",!0),t.addAdjustTreeButton?(c(),g(y,{key:1,icon:"account_tree",onClick:Q,class:"q-ml-xs"},{default:h(()=>[_(R,{anchor:"top middle",self:"bottom middle"},{default:h(()=>e[3]||(e[3]=[j("\uBAA8\uB450\uD3BC\uCE58\uAE30")])),_:1})]),_:1})):p("",!0),t.addCategoryManageComponent&&E.value?(c(),g(y,{key:2,label:"\uCE74\uD14C\uACE0\uB9AC\uAD00\uB9AC",onClick:F,class:"q-ml-xs"})):p("",!0),t.addChooseButton?(c(),g(y,{key:3,label:"\uC120\uD0DD",onClick:U,class:"q-ml-xs"})):p("",!0)]))]))}},Be=ee(be,[["__scopeId","data-v-3e9d8e11"]]),Pe=Object.freeze(Object.defineProperty({__proto__:null,default:Be},Symbol.toStringTag,{value:"Module"}));export{Be as B,Pe as a,ge as b};
