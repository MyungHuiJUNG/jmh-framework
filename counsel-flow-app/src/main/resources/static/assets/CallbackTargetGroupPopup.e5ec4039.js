import{r as _,g as V,y as q,o as r,c as m,w as h,F as D,a as u,z as l,Y as d,Z as c,az as y,ab as b,Q as A,a1 as p,aB as E}from"./index.02f7c95d.js";import{u as k}from"./use-dialog-plugin-component.234e0905.js";import Q from"./ATitleBar.bbf1d9a4.js";import f from"./ABtn.e24d7e8a.js";import w from"./ACheckbox.923db872.js";import{u as $}from"./use-quasar.2d4ce40a.js";import z from"./UserPopup.4dc2e487.js";import{u as F,c as C}from"./representativeServiceStore.1d850f8a.js";import{h as v}from"./errorHandler.5efe1eb1.js";import{s as G}from"./dialog.88ce899f.js";import{_ as M}from"./_plugin-vue_export-helper.cdc0426e.js";import"./ClosePopup.daa62b28.js";/* empty css                                                             */import"./AInput.398f059b.js";import"./TabulatorGrid.9c80b09d.js";import"./ASelect.a02a29e0.js";import"./QItem.1bce08e7.js";import"./QSelect.b17c746f.js";import"./QMenu.3c9cf304.js";import"./position-engine.53490cc8.js";import"./rtl.276c3f1b.js";import"./format.2cae61da.js";import"./organizationStore.a86bd6ff.js";import"./axios.816e1a60.js";import"./header.10137493.js";import"./userApi.abe7b8c8.js";import"./ALoadingSpinner.ca275fb8.js";import"./CommonPopup.2b0ee10b.js";import"./authStore.fadf8446.js";import"./counsel-hub.145170b4.js";const O={class:"column fit"},j={class:"col fit q-pa-xs column",style:{overflow:"auto"}},K={class:"fit a-table"},L={key:0},Y={class:"full-width text-right bg-grey-5 a-border q-pa-xs col-auto"},Z={__name:"CallbackTargetGroupPopup",emits:[...k.emits],setup(H,{emit:J}){const{dialogRef:I,onDialogOK:W}=k(),x=$(),P=F(),s=_([]),o=_([]),U=V({get:()=>o.value.length===s.value.length,set:a=>{o.value=a?s.value.map(t=>t.entityId):[]}});q(()=>{N()});function N(){C.getTargetGroups().then(a=>{a.status===200&&(s.value=a.data)}).catch(a=>{v(a)})}function T(){if(!o.value.length){G("\uB300\uD45C\uC11C\uBE44\uC2A4\uB97C \uC120\uD0DD\uD574\uC8FC\uC138\uC694.");return}x.dialog({component:z,componentProps:{enableRowDblClick:!0,selectableRowsRangeMode:"click",selectableRows:!0}}).onOk(a=>{a.payload.forEach(t=>{s.value.forEach(e=>{o.value.includes(e.entityId)&&!e.users.some(n=>n.entityId===t.entityId)&&(e.users.push(t),e.isUpdated=!0)})})})}function B(a,t){const e=a.users.findIndex(n=>n.entityId===t.entityId);e>-1&&(a.users.splice(e,1),a.isUpdated=!0)}function R(a){o.value.includes(a)?o.value=o.value.filter(t=>t!==a):o.value.push(a)}function S(){const t=s.value.filter(e=>e.isUpdated).map(e=>{const n={entity:{users:e.users.map(i=>({entityId:i.entityId}))}};return C.updateTargetGroup(e.entityId,n)});t.length>0&&Promise.all(t).then(()=>{G("\uC800\uC7A5\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),P.load().then(e=>{s.value=e.data}).catch(e=>{v(e)}),o.value=[]}).catch(e=>{v(e)})}return(a,t)=>(r(),m(D,{ref_key:"dialogRef",ref:I,persistent:"","transition-show":"fade","transition-hide":"fade"},{default:h(()=>[u(A,{class:"dialog-large"},{default:h(()=>[l("div",O,[u(Q,{title:"\uC790\uB3D9\uBD84\uBC30 \uC124\uC815",close:!0,class:"col-auto full-width"}),l("div",j,[l("table",K,[t[5]||(t[5]=l("colgroup",null,[l("col",{width:"30"}),l("col",{width:"30"}),l("col",{width:"50%"}),l("col",{width:"50%"})],-1)),l("thead",null,[l("tr",null,[l("td",null,[u(w,{"model-value":U.value,indeterminate:o.value.length>0&&o.value.length<s.value.length,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e?s.value.map(n=>n.entityId):[])},null,8,["model-value","indeterminate"])]),t[1]||(t[1]=l("td",null,"No",-1)),t[2]||(t[2]=l("td",null,"\uB300\uD45C\uC11C\uBE44\uC2A4",-1)),t[3]||(t[3]=l("td",null,"\uB2F4\uB2F9\uC790",-1))])]),l("tbody",null,[s.value.length===0?(r(),d("tr",L,t[4]||(t[4]=[l("td",{colspan:"4"},"\uB4F1\uB85D\uB41C \uB300\uD45C\uC11C\uBE44\uC2A4\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.",-1)]))):c("",!0),(r(!0),d(b,null,y(s.value,(e,n)=>(r(),d("tr",{key:n},[l("td",null,[u(w,{"model-value":o.value.includes(e.entityId),"onUpdate:modelValue":i=>R(e.entityId)},null,8,["model-value","onUpdate:modelValue"])]),l("td",null,p(n+1),1),l("td",null,p(e.representNumberName)+" ("+p(e.representNumber)+")",1),l("td",null,[(r(!0),d(b,null,y(e.users,(i,g)=>(r(),d("div",{key:g,class:E(["row justify-between",g===0?"":"q-mt-xs"])},[l("span",null,p(i.name)+" ("+p(i.id)+")",1),u(f,{label:"\uC0AD\uC81C",onClick:X=>B(e,i)},null,8,["onClick"])],2))),128))])]))),128))])])]),l("div",Y,[s.value.length?(r(),m(f,{key:0,label:"\uCD94\uAC00",onClick:T})):c("",!0),s.value.length?(r(),m(f,{key:1,label:"\uC800\uC7A5",class:"q-ml-xs",onClick:S})):c("",!0)])])]),_:1})]),_:1},512))}},Te=M(Z,[["__scopeId","data-v-a66f8259"]]);export{Te as default};
