import{r as c,g as L,t as z,y as F,o as j,Y as H,z as f,a as p,B as G}from"./index.02f7c95d.js";import U from"./TabulatorGrid.9c80b09d.js";import{p as A}from"./permissionApi.ffe0b82d.js";import{a as $,u as Y}from"./permissionStore.29c18612.js";import{s as v}from"./dialog.88ce899f.js";import{h as C}from"./errorHandler.5efe1eb1.js";import{F as J}from"./FlowRoleCode.12cdb02e.js";import D from"./ABtn.e24d7e8a.js";import Q from"./AInput.398f059b.js";import{_ as W}from"./_plugin-vue_export-helper.cdc0426e.js";import"./axios.816e1a60.js";import"./CommonPopup.2b0ee10b.js";import"./use-dialog-plugin-component.234e0905.js";import"./authStore.fadf8446.js";import"./header.10137493.js";import"./counsel-hub.145170b4.js";/* empty css                                                             */const X={class:"column col fit no-wrap"},Z={class:"col-auto row fixed-height q-mb-xs"},ee={class:"col top-border-left row flex-center q-px-xs"},te={class:"col top-border-right justify-center column q-px-xs"},oe={class:"row"},le={class:"col-auto q-ml-xs text-right"},se={__name:"PermissionRole",emits:["go-menu","go-role"],setup(ne,{emit:re}){const h=$(),u=c(null),N=Y(),O=L(()=>N.hasPermission(J.PERMISSION_ROLE.GROUP_SETTING)),S=c(null),B=[{field:"name",hozAlign:"left",headerHozAlign:"left",headerSort:!1},{field:"toggle",hozAlign:"center",headerSort:!1,formatter:function(t,e,l){let n=t.getValue(),o=document.createElement("div");o.className=`toggle-button ${n?"on":"off"}`;let s=document.createElement("div");return s.className="toggle-knob",o.innerHTML=n?"ON":"OFF",o.appendChild(s),o.outerHTML},cellClick:function(t,e){if(!O.value){v("\uC218\uC815 \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}k();const l=e.getRow().getData();let n=!l.toggle;x(l,n),R(e.getRow(),n),e.getTable().redraw(!0),M(),q()},width:"200"}];function R(t,e){const l=t.getTreeParent();if(l){const n=l.getData();e?(n.toggle=!0,R(l,!0)):l.getTreeChildren().some(i=>i.getData().toggle)||(n.toggle=!1,R(l,!1))}}function x(t,e){t.toggle=e,t.children&&t.children.length>0&&t.children.forEach(l=>x(l,e))}const b=c([]);function y(){A.getRoles().then(t=>{if(t.status===200){const e=n=>n.map(o=>{const{children:s,entityId:i,...w}=o,m=h.roleIds.includes(i),g={...w,id:i,toggle:m};return s&&s.length>0&&(g.children=e(s)),g}).sort((o,s)=>o.orderNumber-s.orderNumber),l=e(t.data);b.value=l,I()}}).catch(t=>{C(t)})}function k(){S.value=u.value.getScrollPosition()}function q(){u.value.scrollMove(S.value)}function P(t){K.value=t}const K=c([]);function M(){if(h.entityId==null){v("\uC120\uD0DD\uB41C \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}const t=u.value.getData(),e=[];function l(o){o.toggle&&e.push({entityId:o.id}),o.children&&o.children.length>0&&o.children.forEach(s=>l(s))}t.forEach(o=>l(o));const n={entities:e};A.postRolesByPermission(n,h.entityId).then(()=>{}).catch(o=>{C(o)})}z(()=>h.roleIds,()=>{y()},{immediate:!0}),F(()=>y());const r=c([]),a=c(-1),d=c(""),_=c("");function E(){if(!!d.value)if(r.value.length===0||a.value===-1||d.value!==_.value){let e=function(n,o){const s=[];for(let i of n){const w=i.getData();Object.values(w).some(g=>g&&g.toString().toLowerCase().includes(o.toLowerCase()))&&s.push(i);const m=i.getTreeChildren();m&&m.length>0&&s.push(...e(m,o))}return s};const t=u.value.getRows(),l=e(t,d.value);l.length>0?(r.value=l,a.value=0,_.value=d.value,T()):(r.value=[],a.value=-1,v("\uAC80\uC0C9 \uACB0\uACFC\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4."))}else V()}function V(){if(r.value.length===0){v("\uAC80\uC0C9 \uACB0\uACFC\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.");return}a.value=(a.value+1)%r.value.length,T()}function T(){if(u.value.deselectAllRows(),r.value.length===0||a.value===-1)return;const t=r.value[a.value];u.value.scrollToRow(t,"top"),t.select()}function I(){d.value="",a.value=-1,_.value="",r.value=[]}return(t,e)=>(j(),H("div",X,[f("div",Z,[e[2]||(e[2]=f("div",{class:"col-auto t-column text-left top-border-left justify-center column q-px-xs"},"\uAD8C\uD55C\uBA85",-1)),f("div",ee,[p(Q,{class:"text-no-wrap col",modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=l=>d.value=l),onKeyup:G(E,["enter"])},null,8,["modelValue"])]),f("div",te,[f("div",oe,[e[1]||(e[1]=f("div",{class:"col"},null,-1)),f("div",le,[p(D,{label:"\uC870\uD68C",onClick:E}),p(D,{label:"\uCD08\uAE30\uD654",class:"q-ml-xs",onClick:I})])])])]),p(U,{rows:b.value,columns:B,onRowSelected:P,onRowDeselected:P,class:"full-width col",dataTree:!0,dataTreeStartExpanded:!0,selectableRows:1,ref_key:"childRef",ref:u},null,8,["rows"])]))}},ye=W(se,[["__scopeId","data-v-78078672"]]);export{ye as default};
