import B from"./TabulatorGrid.9c80b09d.js";import{h as u}from"./errorHandler.5efe1eb1.js";import{a as F,s as m}from"./dialog.88ce899f.js";import R from"./ABtn.e24d7e8a.js";import{s as l}from"./siteLinkApi.567397ec.js";import j from"./ATitleBar.bbf1d9a4.js";import{F as S}from"./FlowRoleCode.12cdb02e.js";import{u as K}from"./permissionStore.29c18612.js";import $ from"./ALoadingSpinner.ca275fb8.js";import{r as h,g as E,y as W,o as f,Y as x,a as _,c as I,Z as y}from"./index.02f7c95d.js";import"./authStore.fadf8446.js";import"./axios.816e1a60.js";import"./header.10137493.js";import"./counsel-hub.145170b4.js";import"./CommonPopup.2b0ee10b.js";import"./use-dialog-plugin-component.234e0905.js";/* empty css                                                             */import"./_plugin-vue_export-helper.cdc0426e.js";import"./ClosePopup.daa62b28.js";import"./permissionApi.ffe0b82d.js";const Y={class:"column no-wrap fit a-border q-pa-xs",style:{"min-height":"730px"}},Z={key:0,class:"col-auto bg-grey-5 text-right q-pa-xs"},we={__name:"SiteLinkManage",setup(G){const p=h(!1),w=K(),v=E(()=>w.hasPermission(S.SITE_LINK_ROLE.ADD)),D=E(()=>w.hasPermission(S.SITE_LINK_ROLE.DELETE)),A=E(()=>w.hasPermission(S.SITE_LINK_ROLE.SAVE)),L=h(null),N={headerSort:!1,resizable:!1,minWidth:30,width:30,rowHandle:!0,formatter:"handle"},s=h([]),z=[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerHozAlign:"center",headerSort:!1,width:20},{title:"#",formatter:"rownum",headerHozAlign:"center",hozAlign:"center",headerSort:!1,width:50},{title:"\uB9C1\uD06C\uBA85",field:"name",hozAlign:"left",headerHozAlign:"center",headerSort:!1,editor:"input",cellEdited:function(e){const t=e.getRow().getData();t._isModified=!0}},{title:"\uB9C1\uD06CUrl",field:"linkUrl",hozAlign:"left",headerHozAlign:"center",headerSort:!1,editor:"input",cellEdited:function(e){const t=e.getRow().getData();t._isModified=!0}},{title:"\uC0AC\uC6A9\uC5EC\uBD80",field:"usable",hozAlign:"center",headerHozAlign:"center",headerSort:!1,width:"150",editor:"list",editorParams:{values:{true:"\uC0AC\uC6A9",false:"\uC0AC\uC6A9 \uC548\uD568"}},formatter:function(e){const t=e.getValue();return t===!0||t==="true"?"\uC0AC\uC6A9":"\uC0AC\uC6A9 \uC548\uD568"},cellEdited:function(e){let t=e.getValue();if(t==="true"||t==="\uC0AC\uC6A9"?t=!0:(t==="false"||t==="\uC0AC\uC6A9 \uC548\uD568")&&(t=!1),typeof t=="boolean")e.getRow().update({usable:t});else{const o=e.getOldValue();e.setValue(o)}e.getRow().reformat();const n=e.getRow().getData();n._isModified=!0}},{title:"\uC544\uC774\uCF58\uC774\uBBF8\uC9C0",field:"iconFile",hozAlign:"center",headerHozAlign:"center",headerSort:!1,width:"150",formatter:function(e,t,n){const o=e.getRow().getData(),r=document.createElement("div");r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="space-between",r.style.width="100%",r.title="\uAC00\uB85C\uC640 \uC138\uB85C\uC758 \uD574\uC0C1\uB3C4\uAC00 \uBE44\uC2B7\uD55C \uD06C\uAE30\uC758 \uC774\uBBF8\uC9C0\uC5EC\uC57C \uD569\uB2C8\uB2E4.";const i=document.createElement("div");i.style.display="flex",i.style.alignItems="center";const a=document.createElement("img");a.style.width="30px",a.style.height="30px",a.style.marginRight="5px",i.appendChild(a);const g=o.iconSrc||(o.iconImageFile?o.iconImageFile.downloadUrl:null);o.iconSrc?a.src=o.iconSrc:o.iconImageFile&&o.iconImageFile.downloadUrl&&l.getImageWithToken(o.iconImageFile.downloadUrl).then(c=>{a.src=c}).catch(c=>{u(c)}),r.appendChild(i);const k=document.createElement("button");return k.innerText=g?"\uC0AD\uC81C":"\uB4F1\uB85D",k.addEventListener("click",async function(c){if(c.stopPropagation(),g){if(await F("\uC774\uBBF8\uC9C0\uB97C \uC0AD\uC81C \uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?"))try{await l.deleteIconImg(o.entityId),o.iconSrc=null,o.iconImageFile=null,e.getRow().update(o),e.getTable().redraw(!0)}catch(q){u(q)}}else M(o,e)}),r.appendChild(k),r},cellEdited:function(e){const t=e.getRow().getData();t._isModified=!0}},{title:"\uC124\uBA85",field:"description",hozAlign:"left",headerHozAlign:"center",headerSort:!1,editor:"input",cellEdited:function(e){const t=e.getRow().getData();t._isModified=!0}}],d=h([]);W(()=>{b()});function M(e,t){const n=document.createElement("input");n.type="file",n.accept="image/*",n.style.display="none",n.addEventListener("change",function(){const o=n.files[0];if(o){if(!["image/jpeg","image/png","image/gif","image/webp"].includes(o.type)){m("\uC774\uBBF8\uC9C0 \uD30C\uC77C\uB9CC \uC5C5\uB85C\uB4DC \uAC00\uB2A5\uD569\uB2C8\uB2E4."),n.value="";return}e.iconFile=o,e._isModified=!0;const i=new FileReader;i.onload=function(a){const g=a.target.result;e.iconSrc=g,t.getRow().update(e),t.getTable().redraw(!0)},i.readAsDataURL(o)}}),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function V(){s.value.unshift({name:null,linkUrl:null,usable:!0});let e=0;s.value.forEach(t=>{const n=e+1;t.orderNumber!==n&&(t._isModified=!0),t.orderNumber=n,e++})}function C(e){e.forEach((t,n)=>{const o=n+1;t.orderNumber!==o&&(t._isModified=!0),t.orderNumber=o}),s.value=e}function T(e){return e.every(t=>t.name&&t.linkUrl)}function H(e){try{return new URL(e),!0}catch{return!1}}function P(){const e=L.value.getData(),t=[],n=[];if(!T(e)){m("\uB9C1\uD06C\uBA85\uACFC \uB9C1\uD06CUrl\uC740 \uD544\uC218\uAC12\uC785\uB2C8\uB2E4.");return}if(e.forEach(i=>{i.entityId?i.entityId&&i._isModified&&n.push(i):t.push(i)}),!t.length&&!n.length)return;const o=[];if([...t,...n].forEach(i=>{H(i.linkUrl)||o.push(i.linkUrl||"\uC54C \uC218 \uC5C6\uB294 \uD56D\uBAA9")}),o.length){m(`\uB2E4\uC74C \uD56D\uBAA9\uC758 \uB9C1\uD06C URL\uC774 \uC720\uD6A8\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4:
${o.join(", ")}`);return}const r=[];t.forEach(i=>{const a=new FormData;a.append("entity.name",i.name),a.append("entity.linkUrl",i.linkUrl),a.append("entity.orderNumber",i.orderNumber),a.append("entity.usable",i.usable),i.description&&a.append("entity.description",i.description),i.iconFile&&a.append("iconFile",i.iconFile),r.push(l.saveSiteLink(a))}),n.forEach(i=>{const a=new FormData;a.append("entity.name",i.name),a.append("entity.linkUrl",i.linkUrl),a.append("entity.orderNumber",i.orderNumber),a.append("entity.usable",i.usable),i.description&&a.append("entity.description",i.description),i.iconFile&&a.append("iconFile",i.iconFile),r.push(l.updateSiteLink(i.entityId,a))}),Promise.all(r).then(()=>{m("\uC800\uC7A5\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),b()}).catch(i=>{u(i)})}function b(){p.value=!0,l.getSiteLinks().then(e=>{if(e.status===200){const t=e.data.sort((n,o)=>n.orderNumber-o.orderNumber);s.value=t}}).catch(e=>{u(e)}).finally(()=>{p.value=!1})}function U(e){d.value=e}function O(){if(!d.value.length){m("\uC0AD\uC81C\uD560 \uD56D\uBAA9\uC744 \uC120\uD0DD\uD558\uC138\uC694.");return}let e="";for(const t in d.value)t>0&&(e+=","),e+=d.value[t].entityId;F("\uC120\uD0DD\uD55C \uD56D\uBAA9\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?").then(t=>{t&&l.deleteSiteLinks(e).then(n=>{n.status===200&&(d.value=[],b())}).catch(n=>{u(n)})})}return(e,t)=>(f(),x("div",Y,[_(j,{title:"\uC0AC\uC774\uD2B8\uB9C1\uD06C \uBAA9\uB85D",class:"col-auto full-width q-mb-xs"}),_(B,{rows:s.value,columns:z,"movable-rows":"","row-header":N,class:"full-width col",ref_key:"grid",ref:L,"selectable-rows":!0,selectableRowsRangeMode:"click",onRowSelected:U,onRowDeselected:U,onRowMoved:C},null,8,["rows"]),v.value||D.value||A.value?(f(),x("div",Z,[v.value?(f(),I(R,{key:0,label:"\uCD94\uAC00",onClick:V})):y("",!0),D.value?(f(),I(R,{key:1,label:"\uC0AD\uC81C",class:"q-ml-xs",onClick:O})):y("",!0),v.value||A.value?(f(),I(R,{key:2,label:"\uC800\uC7A5",class:"q-ml-xs",onClick:P})):y("",!0)])):y("",!0),_($,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=n=>p.value=n)},null,8,["modelValue"])]))}};export{we as default};
