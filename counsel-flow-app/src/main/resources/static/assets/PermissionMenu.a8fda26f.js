import{g as F,r as u,y as j,t as G,o as H,Y as U,z as m,a as h,B as $}from"./index.02f7c95d.js";import Y from"./TabulatorGrid.9c80b09d.js";import{p as T}from"./permissionApi.ffe0b82d.js";import{a as J,u as Q}from"./permissionStore.29c18612.js";import{u as W}from"./authStore.fadf8446.js";import{u as X}from"./menuStore.ccd61f24.js";import{s as v}from"./dialog.88ce899f.js";import{h as A}from"./errorHandler.5efe1eb1.js";import{F as Z}from"./FlowRoleCode.12cdb02e.js";import C from"./ABtn.e24d7e8a.js";import ee from"./AInput.398f059b.js";import{_ as te}from"./_plugin-vue_export-helper.cdc0426e.js";import"./axios.816e1a60.js";import"./header.10137493.js";import"./menuApi.a7c1508d.js";import"./CommonPopup.2b0ee10b.js";import"./use-dialog-plugin-component.234e0905.js";import"./counsel-hub.145170b4.js";/* empty css                                                             */const oe={class:"column col fit no-wrap"},se={class:"col-auto row fixed-height q-mb-xs"},le={class:"col top-border-left row flex-center q-px-xs"},ne={class:"col top-border-right justify-center column q-px-xs"},re={class:"row"},ae={class:"col-auto q-ml-xs text-right"},ie={__name:"PermissionMenu",emits:["go-menu","go-role"],setup(ue,{emit:ce}){const p=J(),D=W(),N=X(),O=Q(),B=F(()=>O.hasPermission(Z.PERMISSION_ROLE.GROUP_SETTING)),S=u(null),c=u(null),k=[{field:"name",hozAlign:"left",headerHozAlign:"left",headerSort:!1},{field:"toggle",hozAlign:"center",headerSort:!1,formatter:function(t,e,s){let n=t.getValue(),o=document.createElement("div");o.className=`toggle-button ${n?"on":"off"}`;let l=document.createElement("div");return l.className="toggle-knob",o.innerHTML=n?"ON":"OFF",o.appendChild(l),o.outerHTML},cellClick:function(t,e){if(!B.value){v("\uC218\uC815 \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}q();const s=e.getRow().getData();let n=!s.toggle;b(s,n),_(e.getRow(),n),e.getTable().redraw(!0),L(),K()},width:"200"}];function _(t,e){const s=t.getTreeParent();if(s){const n=s.getData();e?(n.toggle=!0,_(s,!0)):s.getTreeChildren().some(i=>i.getData().toggle)||(n.toggle=!1,_(s,!1))}}function b(t,e){t.toggle=e,t.children&&t.children.length>0&&t.children.forEach(s=>b(s,e))}const x=u([]);function y(){T.getMenus().then(t=>{if(t.status===200){const e=n=>n.map(o=>{const{children:l,entityId:i,...R}=o,f=p.menuIds.includes(i),g={...R,id:i,toggle:f};return l&&l.length>0&&(g.children=e(l)),g}).sort((o,l)=>o.orderNumber-l.orderNumber),s=e(t.data);x.value=s,I()}}).catch(t=>{A(t)})}function q(){S.value=c.value.getScrollPosition()}function K(){c.value.scrollMove(S.value)}function M(t){V.value=t}const V=u([]);function L(){if(p.entityId==null){v("\uC120\uD0DD\uB41C \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}const t=c.value.getData(),e=[];function s(o){o.toggle&&e.push({entityId:o.id}),o.children&&o.children.length>0&&o.children.forEach(l=>s(l))}t.forEach(o=>s(o));const n={entities:e};T.postMenusByPermission(n,p.entityId).then(()=>{N.getMenus(D.roleGroup.entityId)}).catch(o=>{A(o)})}j(()=>y()),G(()=>p.menuIds,()=>{y()},{immediate:!0});const r=u([]),a=u(-1),d=u(""),w=u("");function P(){if(!!d.value)if(r.value.length===0||a.value===-1||d.value!==w.value){let e=function(n,o){const l=[];for(let i of n){const R=i.getData();Object.values(R).some(g=>g&&g.toString().toLowerCase().includes(o.toLowerCase()))&&l.push(i);const f=i.getTreeChildren();f&&f.length>0&&l.push(...e(f,o))}return l};const t=c.value.getRows(),s=e(t,d.value);s.length>0?(r.value=s,a.value=0,w.value=d.value,E()):(r.value=[],a.value=-1,v("\uAC80\uC0C9 \uACB0\uACFC\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4."))}else z()}function z(){if(r.value.length===0){v("\uAC80\uC0C9 \uACB0\uACFC\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.");return}a.value=(a.value+1)%r.value.length,E()}function E(){if(c.value.deselectAllRows(),r.value.length===0||a.value===-1)return;const t=r.value[a.value];c.value.scrollToRow(t,"top"),t.select()}function I(){d.value="",a.value=-1,w.value="",r.value=[]}return(t,e)=>(H(),U("div",oe,[m("div",se,[e[2]||(e[2]=m("div",{class:"col-auto t-column text-left top-border-left justify-center column q-px-xs"},"\uAD8C\uD55C\uBA85",-1)),m("div",le,[h(ee,{class:"text-no-wrap col",modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s),onKeyup:$(P,["enter"])},null,8,["modelValue"])]),m("div",ne,[m("div",re,[e[1]||(e[1]=m("div",{class:"col"},null,-1)),m("div",ae,[h(C,{label:"\uC870\uD68C",onClick:P}),h(C,{label:"\uCD08\uAE30\uD654",class:"q-ml-xs",onClick:I})])])])]),h(Y,{rows:x.value,columns:k,onRowSelected:M,onRowDeselected:M,class:"full-width col",dataTree:!0,dataTreeStartExpanded:!0,selectableRows:1,ref_key:"childRef",ref:c},null,8,["rows"])]))}},Ae=te(ie,[["__scopeId","data-v-28fb94b8"]]);export{Ae as default};
