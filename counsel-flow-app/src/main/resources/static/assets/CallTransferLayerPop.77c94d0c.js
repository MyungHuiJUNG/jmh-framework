import{k as S,r as n,g as T,y as G,u as J,o as W,c as X,w as R,a as o,Q as Y,z as s,B as E,F as ee}from"./index.02f7c95d.js";import{u as le}from"./use-dialog-plugin-component.234e0905.js";import te from"./ATitleBar.bbf1d9a4.js";import{u as H}from"./userApi.abe7b8c8.js";import oe from"./TabulatorGrid.9c80b09d.js";import I from"./AInput.398f059b.js";import f from"./ABtn.e24d7e8a.js";import{u as ae}from"./organizationStore.a86bd6ff.js";import{s as _}from"./dialog.88ce899f.js";import{u as ne}from"./use-quasar.2d4ce40a.js";import{h as L}from"./errorHandler.5efe1eb1.js";import{_ as se}from"./_plugin-vue_export-helper.cdc0426e.js";import"./ClosePopup.daa62b28.js";import"./axios.816e1a60.js";/* empty css                                                             */import"./header.10137493.js";import"./CommonPopup.2b0ee10b.js";import"./authStore.fadf8446.js";import"./counsel-hub.145170b4.js";const re={class:"q-pa-xs col column"},ie={class:"a-border q-pa-xs column full-width col"},ce={class:"row justify-between col-auto q-mb-xs flex-center"},ue={class:"row"},de={class:"q-pa-xs t-border"},fe={class:"text-right"},pe={class:"row justify-between full-width col-auto q-pa-xs"},me={class:"row flex-center"},ge={class:"row"},he="\uD638\uC804\uD658",ve=100,Ce={__name:"CallTransferLayerPop",setup(_e){const y=ne(),p=S().appContext.config.globalProperties.$emitter,u=S().appContext.config.globalProperties.$channel,{dialogRef:U,onDialogOK:w,onDialogCancel:ye}=le(),b=ae(),g=n(),h=n([]),a=n(""),v=n(!1),C=n("\uC5F0\uACB0"),F=[{title:"\uC0AC\uC6A9\uC790\uBA85",field:"entityId",headerHozAlign:"center",hozAlign:"center",headerSort:!1,formatter:function(e){const l=e.getData();return l.name+` [${l.id}]`}},{title:"\uB0B4\uC120",field:"ctiExtension",headerHozAlign:"center",hozAlign:"center",headerSort:!1},{title:"\uC870\uC9C1(\uB300)",field:"organization",headerHozAlign:"center",hozAlign:"center",headerSort:!1,formatter:function(e){var r,i,c;const l=((r=e.getValue())==null?void 0:r.path)||null;if(!l)return null;const t=l.split(".");return(c=(i=b.organizations.get(t[0]))==null?void 0:i.name)!=null?c:t[0]}},{title:"\uC870\uC9C1(\uC911)",field:"organization",headerHozAlign:"center",hozAlign:"center",headerSort:!1,formatter:function(e){var r,i,c;const l=((r=e.getValue())==null?void 0:r.path)||null;if(!l)return null;const t=l.split(".");return t.length<2?null:(c=(i=b.organizations.get(t[1]))==null?void 0:i.name)!=null?c:t[1]}},{title:"\uC870\uC9C1(\uC18C)",field:"organization",headerHozAlign:"center",hozAlign:"center",headerSort:!1,formatter:function(e){var r,i,c;const l=((r=e.getValue())==null?void 0:r.path)||null;if(!l)return null;const t=l.split(".");return t.length<3?null:(c=(i=b.organizations.get(t[2]))==null?void 0:i.name)!=null?c:t[2]}}],m=n(0),x=n(!1),d=n({}),P=n(T(()=>{var e;return((e=u==null?void 0:u.channelInfo)==null?void 0:e.state)||null})),$=n(T(()=>{var e,l;return((l=(e=u==null?void 0:u.channelInfo)==null?void 0:e.callInfo)==null?void 0:l.callType)||null}));G(()=>{A(),B(),p.on("consultCallRequested",q),p.on("consultCallResponse",z)}),J(()=>{p.off("consultCallRequested",q),p.off("consultCallResponse",z)});function B(){P.value===CounselFlowHubVoiceCode.ChannelState.ACTIVE&&$.value===CounselFlowHubVoiceCode.CallType.CONSULT&&z(!0)}function A(e){m.value=0,d.value={page:m.value,size:ve},e&&(d.value["entity.name"]=e.trim()),H.getUsers(d.value).then(l=>{l.status===200&&(h.value=l.data.content,x.value=l.data.last,m.value+=1)}).catch(l=>{L(l)})}function V(){A(g.value)}function N(){g.value=null,A()}async function D(){if(!x.value){d.value={...d.value,page:m.value};try{const e=await H.getUsers(d.value);e.status===200&&(h.value=[...h.value,...e.data.content],x.value=e.data.last,m.value+=1)}catch(e){L(e)}}}function K(e){a.value=e.ctiExtension}function k(){if(!a.value){_("\uB0B4\uC120\uBC88\uD638\uB97C \uC120\uD0DD \uB610\uB294 \uC785\uB825\uD574\uC8FC\uC138\uC694.");return}/^\d+$/.test(a.value)?p.emit("makeConsultCall",a.value):_("\uB0B4\uC120\uBC88\uD638\uB294 \uC22B\uC790\uB9CC \uD3EC\uD568\uD574\uC57C \uD569\uB2C8\uB2E4.")}function O(){if(!a.value){_("\uB0B4\uC120\uBC88\uD638\uB97C \uC120\uD0DD \uB610\uB294 \uC785\uB825\uD574\uC8FC\uC138\uC694.");return}const e={callType:CounselFlowHubVoiceCode.CallType.TRANSFER,dial:a.value};w(e)}function Q(){w({callType:"retrieve"})}function j(){if(!a.value){_("\uB0B4\uC120\uBC88\uD638\uB97C \uC120\uD0DD \uB610\uB294 \uC785\uB825\uD574\uC8FC\uC138\uC694.");return}const e={callType:CounselFlowHubVoiceCode.CallType.CONFERENCE,dial:a.value};w(e)}function q(){C.value="\uC5F0\uACB0\uC911",M()}function z(e){v.value=e,e?C.value="\uD611\uC758\uD1B5\uD654\uC911":C.value="\uC5F0\uACB0",Z()}function M(){y.loading.show({message:"\uD611\uC758\uC804\uD654 \uC694\uCCAD\uC911\uC785\uB2C8\uB2E4.",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"})}function Z(){y.loading.isActive&&y.loading.hide()}return(e,l)=>(W(),X(ee,{ref_key:"dialogRef",ref:U,persistent:"","transition-show":"fade","transition-hide":"fade"},{default:R(()=>[o(Y,{class:"dialog-large column full-width"},{default:R(()=>[o(te,{close:!0,title:he,class:"col-auto full-width"}),s("div",re,[s("div",ie,[s("div",ce,[s("div",ue,[l[2]||(l[2]=s("div",{class:"t-column q-pa-xs text-center"},"\uC0AC\uC6A9\uC790\uBA85",-1)),s("div",de,[o(I,{modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=t=>g.value=t),onKeyup:E(V,["enter"])},null,8,["modelValue"])])]),s("div",fe,[o(f,{label:"\uC870\uD68C",onClick:V}),o(f,{label:"\uCD08\uAE30\uD654",onClick:N,class:"q-ml-xs"})])]),o(oe,{rows:h.value,columns:F,"selectable-rows":1,class:"full-width",height:"450px","infinite-scroll":D,onRowClick:K},null,8,["rows"])]),s("div",pe,[s("div",me,[o(I,{modelValue:a.value,"onUpdate:modelValue":l[1]||(l[1]=t=>a.value=t),class:"col",placeholder:"\uB0B4\uC120\uBC88\uD638",onKeyup:E(k,["enter"])},null,8,["modelValue"]),o(f,{label:C.value,class:"q-ml-xs",color:"primary",onClick:k,disable:v.value},null,8,["label","disable"])]),s("div",ge,[o(f,{label:"3\uC790 \uD1B5\uD654",color:"primary",onClick:j,disable:!v.value},null,8,["disable"]),o(f,{label:"\uD638\uC804\uD658",class:"q-ml-xs",color:"primary",onClick:O,disable:!v.value},null,8,["disable"]),o(f,{label:"\uC7AC\uC5F0\uACB0",class:"q-ml-xs",color:"primary",onClick:Q})])])])]),_:1})]),_:1},512))}},Be=se(Ce,[["__scopeId","data-v-0edc3d3f"]]);export{Be as default};
