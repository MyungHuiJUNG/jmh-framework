import R from"./AccessLogSearchBar.57b276bb.js";import V from"./TabulatorGrid.9c80b09d.js";import B from"./ATitleBar.bbf1d9a4.js";import{u as b}from"./codeStore.e69f9e04.js";import{api as j}from"./axios.816e1a60.js";import{g as C}from"./header.10137493.js";import{h as p}from"./errorHandler.5efe1eb1.js";import{F}from"./FlowRoleCode.12cdb02e.js";import{u as k}from"./permissionStore.29c18612.js";import{s as z}from"./dialog.88ce899f.js";import G from"./ALoadingSpinner.ca275fb8.js";import{r as s,g as I,y as N,o as O,Y as T,z as D,a as f}from"./index.02f7c95d.js";import"./use-quasar.2d4ce40a.js";import"./UserPopup.4dc2e487.js";import"./AInput.398f059b.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./ABtn.e24d7e8a.js";/* empty css                                                             */import"./ACheckbox.923db872.js";import"./ASelect.a02a29e0.js";import"./QItem.1bce08e7.js";import"./QSelect.b17c746f.js";import"./QMenu.3c9cf304.js";import"./position-engine.53490cc8.js";import"./rtl.276c3f1b.js";import"./format.2cae61da.js";import"./use-dialog-plugin-component.234e0905.js";import"./organizationStore.a86bd6ff.js";import"./userApi.abe7b8c8.js";import"./FlowSystemCode.7be7ce49.js";import"./ClosePopup.daa62b28.js";import"./authStore.fadf8446.js";import"./counsel-hub.145170b4.js";import"./permissionApi.ffe0b82d.js";import"./CommonPopup.2b0ee10b.js";const U=v=>j.get("/rest/api/v1/access-log/access-logs",{params:{...v,sort:"createdDate,desc"},...C("yyyy-MM-dd HH:mm:ss")}),d={getAccessLogs:U},Y={class:"column no-wrap fit a-border q-pa-xs",style:{"min-height":"680px"}},J={class:"col-auto q-mb-xs"},K={class:"col column no-wrap a-border q-pa-xs"},Q="/rest/api/v1/access-log/access-logs",Ee={__name:"AccessLogManage",setup(v){const i=s(!1),L=k(),h=I(()=>L.hasPermission(F.ACCESS_LOG_ROLE.READ)),u=s(!1),S=b(),c=s([]),y=[{title:"\uC811\uC18D\uC77C\uC2DC",field:"accessDate",headerHozAlign:"center",hozAlign:"center"},{title:"\uC811\uC18D\uC720\uD615",field:"accessType",headerHozAlign:"center",hozAlign:"center",formatter:function(e){var o,l;const t=e.getValue()||null;return(l=(o=S.codes.get(t))==null?void 0:o.name)!=null?l:t}},{title:"\uC0AC\uC6A9\uC790",field:"user",headerHozAlign:"center",hozAlign:"center",formatter:function(e){const t=e.getData();return t.user.name+` [${t.user.id}]`}},{title:"\uC811\uC18Dip",field:"clientIpAddress",headerHozAlign:"center",hozAlign:"center"}],n=s(0),m=s(100),g=s(!1),a=s();s(A(x(new Date))),s(A(M(new Date))),N(()=>{$()});function x(e){const t=new Date(e);return t.setMonth(e.getMonth()-1),t}function M(e){const t=new Date(e);return t.setDate(e.getDate()+1),t}function A(e){e.setHours(0,0,0,0);const t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${l} 00:00:00`}function $(){if(!h.value){z("\uC811\uC18D \uB85C\uADF8 \uC870\uD68C \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}u.value?a.value={}:(i.value=!0,n.value=0,a.value={page:n.value,size:m.value},d.getAccessLogs(a.value).then(e=>{e.status===200&&(c.value=e.data.content,g.value=e.data.last,n.value+=1)}).catch(e=>{p(e)}).finally(()=>{i.value=!1}))}async function H(){if(!u.value&&!g.value){a.value={...a.value,page:n.value};try{const e=await d.getAccessLogs(a.value);e.status===200&&(c.value=[...c.value,...e.data.content],g.value=e.data.last,n.value+=1)}catch(e){p(e)}}}function P(e){if(!h.value){z("\uC811\uC18D \uB85C\uADF8 \uC870\uD68C \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}u.value?(a.value={...e},q()):(i.value=!0,n.value=0,a.value={page:n.value,size:m.value,...e},d.getAccessLogs(a.value).then(t=>{t&&t.data&&(c.value=t.data.content,g.value=t.data.last,n.value+=1)}).catch(t=>{p(t)}).finally(()=>{i.value=!1}))}function q(){grid.value.setData()}function E(e,t,o){return a.value={...a.value,page:o.page-1,size:o.size||m.value,isPaging:!0},new Promise(function(l,_){d.getAccessLogs(a.value).then(r=>{if(r.status===200){const w={data:r.data.content,last_page:r.data.totalPages,last_row:r.data.totalElements};l(w)}}).catch(r=>{p(r),_(r)})})}return(e,t)=>(O(),T("div",Y,[D("div",J,[f(R,{onSearch:P})]),D("div",K,[f(B,{title:"\uC811\uC18D \uB85C\uADF8",class:"col-auto full-width q-mb-xs"}),f(V,{rows:c.value,columns:y,class:"col",ref:"grid","infinite-scroll":H,"ajax-url":Q,"ajax-request-func":E,pagination:u.value,"pagination-size":m.value},null,8,["rows","pagination","pagination-size"])]),f(G,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=o=>i.value=o)},null,8,["modelValue"])]))}};export{Ee as default};
