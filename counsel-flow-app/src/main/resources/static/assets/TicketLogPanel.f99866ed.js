import{u as U}from"./codeStore.e69f9e04.js";import{u as V}from"./counselTypeStore.5faa86f9.js";import{t as m}from"./ticketApi.d3774daa.js";import j from"./TabulatorGrid.9c80b09d.js";import{h}from"./errorHandler.5efe1eb1.js";import{r,o as L,c as B}from"./index.02f7c95d.js";import"./axios.816e1a60.js";import"./header.10137493.js";import"./dialog.88ce899f.js";import"./CommonPopup.2b0ee10b.js";import"./use-dialog-plugin-component.234e0905.js";import"./authStore.fadf8446.js";import"./counsel-hub.145170b4.js";const F="/rest/api/v1/ticket/tickets",Z={__name:"TicketLogPanel",emits:["rowClick"],setup(I,{expose:D,emit:y}){const k=y,s=V(),u=U();D({getTickets:S});const p=r(null),g=r(!1),w=[{title:"\uD2F0\uCF13\uBC88\uD638",field:"entityId",headerHozAlign:"center",hozAlign:"center"},{title:"\uD2F0\uCF13\uC720\uD615",field:"typeCode",headerHozAlign:"center",hozAlign:"center",formatter:function(t){var n,a;const e=t.getValue()||null;return(a=(n=u.codes.get(e))==null?void 0:n.name)!=null?a:e}},{title:"\uCC98\uB9AC\uC0C1\uD0DC",field:"statusCode",headerHozAlign:"center",hozAlign:"center",formatter:function(t){var n,a;const e=t.getValue()||null;return(a=(n=u.codes.get(e))==null?void 0:n.name)!=null?a:e}},{title:"\uC778\uC785\uCC44\uB110",field:"channels",headerHozAlign:"center",hozAlign:"center",formatter:function(t){const e=t.getValue();let n=null;return e!=null&&e.length&&(n=u.codes.get(e[0].contactCode).name),n}},{title:"\uC218/\uBC1C\uC2E0\uBC88\uD638",field:"tel",headerHozAlign:"center",hozAlign:"center"},{title:"\uBC1C\uD589\uC77C\uC2DC",field:"createdDate",headerHozAlign:"center",hozAlign:"center"},{title:"\uC0C1\uB2F4\uC720\uD615(\uB300)",field:"counselTypeCodeLarge",headerHozAlign:"center",hozAlign:"left",formatter:function(t){var n,a;const e=t.getValue()||null;return(a=(n=s.counselTypes.get(e))==null?void 0:n.name)!=null?a:e}},{title:"\uC0C1\uB2F4\uC720\uD615(\uC911)",field:"counselTypeCodeMedium",headerHozAlign:"center",hozAlign:"left",formatter:function(t){var n,a;const e=t.getValue()||null;return(a=(n=s.counselTypes.get(e))==null?void 0:n.name)!=null?a:e}},{title:"\uC0C1\uB2F4\uC720\uD615(\uC18C)",field:"counselTypeCodeSmall",headerHozAlign:"center",hozAlign:"left",formatter:function(t){var n,a;const e=t.getValue()||null;return(a=(n=s.counselTypes.get(e))==null?void 0:n.name)!=null?a:e}},{title:"\uB2F4\uB2F9\uC790",field:"managerUserName",headerHozAlign:"center",hozAlign:"center",formatter:function(t){const e=t.getData();return e.managerUserName&&e.managerUserId?e.managerUserName+` [${e.managerUserId}]`:null}}],c=r([]),i=r(0),f=r(100),d=r(!1),C=r(v(_(new Date))),T=r(v(H(new Date))),o=r({page:i.value,size:f.value,fromCreatedDate:C.value,toCreatedDate:T.value});function _(t){const e=new Date(t);return e.setMonth(t.getMonth()-1),e}function H(t){const e=new Date(t);return e.setDate(t.getDate()+1),e}function v(t){t.setHours(0,0,0,0);const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${a} 00:00:00`}function S(t){if(g.value){const e={...o.value};t&&(e["entity.tel"]=t),o.value=e,P()}else{i.value=0;const e={...o.value};return t&&(e["entity.tel"]=t),o.value=e,m.getTicket(o.value).then(n=>{n&&n.data&&(c.value=n.data.content,d.value=n.data.last,i.value+=1)}).catch(n=>{h(n)})}}async function $(){if(!g.value&&!d.value){o.value={...o.value,page:i.value};try{const t=await m.getTicket(o.value);t.status===200&&(c.value=[...c.value,...t.data.content],d.value=t.data.last,i.value+=1)}catch(t){h(t)}}}function x(t){k("rowClick",t)}function M(t,e,n){return o.value={...o.value,page:n.page-1,size:n.size||f.value,isPaging:!0},new Promise(function(a,z){m.getTicket(o.value).then(l=>{if(l.status===200){const A={data:l.data.content,last_page:l.data.totalPages,last_row:l.data.totalElements};a(A)}}).catch(l=>{h(l),z(l)})})}function P(){p.value.setData()}return(t,e)=>(L(),B(j,{rows:c.value,columns:w,onRowDblClick:x,"selectable-rows":1,"infinite-scroll":$,"ajax-url":F,"ajax-request-func":M,pagination:g.value,"pagination-size":f.value,ref_key:"grid",ref:p,class:"ticket-grid col fit"},null,8,["rows","pagination","pagination-size"]))}};export{Z as default};
