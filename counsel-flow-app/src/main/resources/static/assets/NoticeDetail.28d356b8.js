import{Q as P}from"./QBadge.c1f4e948.js";import{api as p}from"./axios.816e1a60.js";import{g as y}from"./header.10137493.js";import{f as g,F as re}from"./FileUploadManage.e1cb862f.js";import{u as ce}from"./utils.32a0767f.js";import{s as w,a as H}from"./dialog.88ce899f.js";import{u as ue}from"./permissionStore.29c18612.js";import de from"./ATitleBar.bbf1d9a4.js";import fe from"./AInput.398f059b.js";import Q from"./ABtn.e24d7e8a.js";import{h as v}from"./errorHandler.5efe1eb1.js";import{F as W}from"./FlowRoleCode.12cdb02e.js";import ve from"./ATextEditor.d38287bf.js";import{_ as me}from"./_plugin-vue_export-helper.cdc0426e.js";import{g as E,r as s,o as R,Y as pe,a as m,z as t,w as Y,a0 as N,a1 as F,c as Z,Z as G}from"./index.02f7c95d.js";const ye=a=>p.get(`/rest/api/v1/notice/notices/${a}`,{...y()}),he=a=>{const i={...a,sort:"createdDate,desc"};return p.get("/rest/api/v1/notice/notices",{params:i,...y()})},_e=a=>p.post("/rest/api/v1/notice/notices",a,y()),xe=(a,i)=>p.put(`/rest/api/v1/notice/notices/${a}`,i,y()),be=a=>p.delete(`/rest/api/v1/notice/notices/${a}`,y()),ge=a=>{const i={entityIds:a};return p.delete("/rest/api/v1/notice/notices",{params:i,...y()})},A={getNotice:ye,getNotices:he,saveNotice:_e,updateNotice:xe,deleteNotice:be,deleteNotices:ge};const we={class:"column no-wrap fit"},Ne={class:"col column full-width"},Fe={class:"col-auto row fixed-height full-width"},Ie={class:"col-auto t-column text-left top-border-left q-px-xs column justify-center"},qe={class:"row"},Be={class:"col top-border-right justify-center column q-px-xs"},je={class:"col row full-width"},De={class:"col-auto t-column text-left body-border-left q-px-xs column justify-center full-height"},Se={class:"row"},Ce={class:"col body-border-right q-pa-xs no-wrap text-no-wrap full-height"},Me={class:"col-auto row full-width"},$e={class:"col body-border-right justify-center column q-pa-xs"},ke={class:"col-2 row full-width"},Ue={class:"col body-border-right justify-center no-wrap text-no-wrap overflow-auto",style:{"max-height":"100%","overflow-y":"auto"}},Ee={class:"col-auto row fixed-height"},Re={class:"col body-border-left justify-center text-center column"},Ae={class:"col body-border-right justify-center text-center column"},Oe={class:"col-auto row fixed-height"},Te={class:"col body-border-left justify-center text-center column"},Ve={class:"col body-border-right justify-center text-center column"},ze={class:"col-auto full-width text-right bg-grey-5 a-border q-pa-xs"},Le={__name:"NoticeDetail",emits:["refreshNotice","refreshTabulatorRow"],setup(a,{expose:i,emit:J}){const O=ue(),I=J;i({resetInfo:b,getNotice:ee});const K=E(()=>O.hasPermission(W.NOTICE_ROLE.SAVE)),T=E(()=>O.hasPermission(W.NOTICE_ROLE.ADD)),q=s(""),r=s(""),d=s(""),B=s(),h=s(),X=E(()=>ce.removeHtmlTagsIncludingImg(h.value)),V=s(""),j=s(""),z=s(""),D=s(""),S=s(""),C=s(""),M=s(""),$=s(""),f=s([]),n=s([]),c=s([]),x=s([]),_=new Map;async function ee(o){A.getNotice(o).then(async e=>{const{data:l}=e;if(r.value=l.entityId,d.value=l.title,B.value=l.content,h.value=l.content,V.value=l.createdBy,j.value=l.createdDate,z.value=l.lastModifiedBy,D.value=l.lastModifiedDate,S.value=l.createdByUserId,C.value=l.createdByUserName,M.value=l.lastModifiedByUserId,$.value=l.lastModifiedByUserName,f.value=[],n.value=[],c.value=[],l.files&&l.files.length>0)for(const u of l.files){const U=await g.getFileDetail(u.entityId);f.value.push(U.data)}}).catch(e=>{v(e)})}async function te(){if(!ne())return!1;const o={entity:{title:d.value,content:h.value,rawContent:X.value}};r.value?await A.updateNotice(r.value,o).then(e=>{const l=e.data.entityId;x.value.length>0&&x.value.forEach(u=>{g.removeFile(u).catch(U=>{v(U)})}),c.value.length>0&&g.uploadFile("notice",l,L()).catch(u=>{v(u)}),w("\uC800\uC7A5 \uB418\uC5C8\uC2B5\uB2C8\uB2E4."),b(),I("refreshNotice")}).catch(e=>{v(e)}):await A.saveNotice(o).then(e=>{const l=e.data.entityId;c.value.length!==0&&g.uploadFile("notice",l,L()).catch(u=>{v(u)}),w("\uC800\uC7A5 \uB418\uC5C8\uC2B5\uB2C8\uB2E4."),b(),I("refreshNotice")}).catch(e=>{v(e)})}function oe(o){const e=o.target.files;n.value.push(...e),k(),q.value.value=null}function k(){_.clear(),f.value.forEach(o=>{const e=`${o.fileName}-${o.fileSize}`;_.set(e,o)}),n.value=n.value.filter(o=>{const e=`${o.name}-${o.size}`;return _.has(e)?!1:(_.set(e,o),!0)}),c.value=[],c.value=n.value}function L(){const o=new FormData;return c.value.forEach(e=>{o.append("file",e)}),o}async function le(o){await H("\uD30C\uC77C\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")&&(n.value.splice(o,1),k())}async function se(o,e){await H("\uD30C\uC77C\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")&&(x.value.push(o.entityId),f.value.splice(e,1),k())}function ae(){b()}function b(){r.value=null,d.value=null,B.value=null,V.value=null,j.value=null,z.value=null,D.value=null,S.value=null,C.value=null,M.value=null,$.value=null,f.value=[],n.value=[],c.value=[],x.value=[],_.clear(),I("refreshTabulatorRow"),q.value.value=null}function ne(){if(d.value){if(!h.value)return w("\uB0B4\uC6A9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694."),!1}else return w("\uC81C\uBAA9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694."),!1;return!0}function ie(o){h.value=o}return(o,e)=>(R(),pe("div",we,[m(de,{class:"col-auto full-width q-mb-xs",title:"\uACF5\uC9C0\uC0AC\uD56D \uC138\uBD80\uC815\uBCF4"}),t("div",Ne,[t("div",Fe,[t("div",Ie,[t("div",qe,[m(P,{class:"q-pa-none q-mr-xs",color:"grey-2","text-color":"red"},{default:Y(()=>e[1]||(e[1]=[N("*")])),_:1}),e[2]||(e[2]=N("\uC81C\uBAA9"))])]),t("div",Be,[m(fe,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=l=>d.value=l)},null,8,["modelValue"])])]),t("div",je,[t("div",De,[t("div",Se,[m(P,{class:"q-pa-none q-mr-xs",color:"grey-2","text-color":"red"},{default:Y(()=>e[3]||(e[3]=[N("*")])),_:1}),e[4]||(e[4]=N("\uB0B4\uC6A9"))])]),t("div",Ce,[m(ve,{"content-input":B.value,onContentOutput:ie,class:"no-wrap"},null,8,["content-input"])])]),t("div",Me,[e[5]||(e[5]=t("div",{class:"col-auto t-column text-left body-border-left q-px-xs column justify-center"},"\uCCA8\uBD80\uD30C\uC77C",-1)),t("div",$e,[t("input",{type:"file",onChange:oe,multiple:"",ref_key:"fileInput",ref:q},null,544)])]),t("div",ke,[e[6]||(e[6]=t("div",{class:"col-auto t-column text-left body-border-left q-px-xs column justify-center"},"\uD30C\uC77C\uBAA9\uB85D",-1)),t("div",Ue,[m(re,{filesFromServer:f.value,tempLocalFiles:n.value,onRemoveFile:le,onRemoveServerFile:se},null,8,["filesFromServer","tempLocalFiles"])])]),t("div",Ee,[e[7]||(e[7]=t("div",{class:"col-auto t-column text-left body-border-left q-px-xs column justify-center"},"\uB4F1\uB85D\uC790",-1)),t("div",Re,F(r.value?C.value+` [${S.value}]`:""),1),e[8]||(e[8]=t("div",{class:"col-auto t-column text-left body-border-left q-px-xs column justify-center"},"\uB4F1\uB85D\uC77C\uC790",-1)),t("div",Ae,F(j.value),1)]),t("div",Oe,[e[9]||(e[9]=t("div",{class:"col-auto t-column text-left body-border-left q-px-xs column justify-center"},"\uC218\uC815\uC790",-1)),t("div",Te,F(r.value?$.value+` [${M.value}]`:""),1),e[10]||(e[10]=t("div",{class:"col-auto t-column text-left body-border-left q-px-xs column justify-center"},"\uC218\uC815\uC77C\uC790",-1)),t("div",Ve,F(D.value),1)]),t("div",ze,[T.value?(R(),Z(Q,{key:0,label:"\uC2E0\uADDC",onClick:ae})):G("",!0),T.value&&!r.value||K.value?(R(),Z(Q,{key:1,label:"\uC800\uC7A5",class:"q-ml-xs",onClick:te})):G("",!0)])])]))}},Pe=me(Le,[["__scopeId","data-v-8afabc92"]]),nt=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"}));export{Pe as N,nt as a,A as n};
