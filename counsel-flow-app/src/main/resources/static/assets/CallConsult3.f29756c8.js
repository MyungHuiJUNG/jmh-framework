import{a as X,Q as Z}from"./QTabPanels.3ec79e61.js";import{u as ee}from"./use-quasar.2d4ce40a.js";import te from"./ATab.766fc7d1.js";import ae from"./ATabs.2a11bd5d.js";import oe from"./TicketLogPanel.f99866ed.js";import le from"./NewTicket.788a9e21.js";import H from"./ATitleBar.bbf1d9a4.js";import{k as ne,r,y as se,u as ie,t as ce,o as ue,Y as de,z as d,a as m,$ as pe,w as b}from"./index.02f7c95d.js";/* empty css                                                             */import{_ as re}from"./_plugin-vue_export-helper.cdc0426e.js";import{t as I}from"./ticketApi.d3774daa.js";import{t as k}from"./ticketChannelApi.1f3fe83b.js";import{u as me}from"./codeStore.e69f9e04.js";import{u as fe}from"./counselTypeStore.5faa86f9.js";import{u as Ce}from"./authStore.fadf8446.js";import{C as ge,p as he,a as ve,b as ye,L as Te,c as Ie,d as ke,P as _e,e as De}from"./index.9fc4a15c.js";import"./touch.9135741d.js";import"./position-engine.53490cc8.js";import"./QBadge.c1f4e948.js";import"./QResizeObserver.dd2c8de3.js";import"./rtl.276c3f1b.js";import"./TabulatorGrid.9c80b09d.js";import"./errorHandler.5efe1eb1.js";import"./dialog.88ce899f.js";import"./CommonPopup.2b0ee10b.js";import"./use-dialog-plugin-component.234e0905.js";import"./counsel-hub.145170b4.js";import"./axios.816e1a60.js";import"./header.10137493.js";import"./QTooltip.86ca1c0e.js";import"./QItem.1bce08e7.js";import"./QList.4c243fc6.js";import"./QMenu.3c9cf304.js";import"./lodash.33ed51ec.js";import"./_commonjsHelpers.c10bf6cb.js";import"./ABtn.e24d7e8a.js";import"./ASelect.a02a29e0.js";import"./QSelect.b17c746f.js";import"./format.2cae61da.js";import"./AInput.398f059b.js";import"./UserPopup.4dc2e487.js";import"./ACheckbox.923db872.js";import"./organizationStore.a86bd6ff.js";import"./userApi.abe7b8c8.js";import"./ALoadingSpinner.ca275fb8.js";import"./ClosePopup.daa62b28.js";import"./ATextarea.94103f28.js";/* empty css                                                                  */import"./FlowSystemCode.7be7ce49.js";import"./commandStore.9ed00edb.js";import"./scriptApi.ab757ee5.js";const be={class:"row no-wrap fit",style:{"min-height":"680px"}},Ee={class:"col full-height column no-wrap"},Se={class:"row col-auto q-mb-xs a-border q-pa-xs full-width",style:{height:"247px"}},xe={class:"row col-4"},Ne={class:"col column"},Oe={class:"col q-ml-xs column"},we={class:"q-pa-xs a-border col q-ml-xs"},Ue={class:"q-pt-xs col column no-wrap a-border full-width"},q="COUNSEL_TICKET",K="TICKET_UNPROCESSED",Q="VOICE",Y="INBOUND",z="OUTBOUND",Ae={__name:"CallConsult3",setup(Le){const f=ne().appContext.config.globalProperties.$emitter;ee();const y=r("ticketLog"),C=r([]),v=me(),_=fe(),E=Ce();ge.register(he,ve,ye,Te,Ie,ke,_e);const W=r({labels:["9/1","9/2","9/3","9/4","9/5","9/6","9/7"],datasets:[{label:"\uC778\uBC14\uC6B4\uB4DC",backgroundColor:"#3446eb",data:[140,139,110,140,139,180,234]},{label:"\uC544\uC6C3\uBC14\uC6B4\uB4DC",backgroundColor:"#f87979",data:[120,129,100,120,119,150,134]},{label:"\uD569\uACC4",backgroundColor:"#fc0362",data:[260,268,210,260,258,330,365]}]}),j=r({responsive:!0,maintainAspectRatio:!1}),T=r({}),S=r(null),p=r(),u=r(),x=r(null);se(()=>{window.getTicketData=()=>x.value,f.on("callInStarted",N),f.on("callOutStarted",O),f.on("callEnded",w),f.on("processEnded",U)}),ie(()=>{f.off("callInStarted",N),f.off("callOutStarted",O),f.off("callEnded",w),f.off("processEnded",U)}),ce(()=>T.value,e=>{e&&D(e.tel)});function D(e){S.value.getTickets(e)}function g(e){const t=new Date(e),a=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0"),o=String(t.getSeconds()).padStart(2,"0");return`${a}-${i}-${l} ${n}:${c}:${o}`}async function N(e){const t={},a=e.channelInfo.callInfo;if(!a)return;const i=a.callType;if(!!i){if(i===CounselFlowHubVoiceCode.CallType.CONSULT||i===CounselFlowHubVoiceCode.CallType.CONFERENCE){D(a.xferCallerId);return}i===CounselFlowHubVoiceCode.CallType.NORMAL?t.tel=a.callerId:i===CounselFlowHubVoiceCode.CallType.TRANSFER&&(t.tel=a.xferCallerId),e.expiredDate&&(t.startDate=g(e.expiredDate)),t.typeCode=q,t.statusCode=K,t.managerEid=E.entityId,t.isManualCreated="N",await I.saveTicket(t).then(l=>{if(l.status===200){p.value=l.data.entityId,console.log("[\uCD5C\uCD08 \uD2F0\uCF13 \uBC1C\uD589 \uC131\uACF5] : ",p.value);const n={},c=e.channelInfo;n.ticketEntityId=p.value,n.typeCode=Q,c.callInfo.extraData.ucid&&(n.extraData=c.callInfo.extraData.ucid),n.contactCode=Y,n.startDate=g(e.expiredDate),n.key=a.callId,k.saveTicketChannel(n).then(o=>{o.status===200&&(u.value=o.data.entityId,console.log("[\uD2F0\uCF13 \uCC44\uB110 \uBC1C\uD589] : ",u.value),I.getTicketByEntityId(p.value).then(s=>{s.status===200&&(console.log("[\uD2F0\uCF13 \uC0C1\uC138\uC815\uBCF4 \uC870\uD68C] : ",p.value),T.value=s.data)}).catch(s=>{s.response.status===400&&s.response.data.message&&showAlert(s.response.data.message),console.log(s)}))}).catch(o=>{o.response.status===400&&o.response.data.message&&showAlert(o.response.data.message),console.log(o)})}}).catch(l=>{l.response.status===400&&l.response.data.message&&showAlert(l.response.data.message),console.log(l)})}}async function O(e){const t={},a=e.channelInfo.callInfo;if(!a)return;const i=a.callType;!i||i===CounselFlowHubVoiceCode.CallType.CONSULT||i===CounselFlowHubVoiceCode.CallType.CONFERENCE||i===CounselFlowHubVoiceCode.CallType.TRANSFER||(t.tel=a.calledId,e.expiredDate&&(t.startDate=g(e.expiredDate)),t.typeCode=q,t.statusCode=K,t.managerEid=E.entityId,t.isManualCreated="N",await I.saveTicket(t).then(l=>{if(l.status===200){p.value=l.data.entityId,console.log("[\uCD5C\uCD08 \uD2F0\uCF13 \uBC1C\uD589 \uC131\uACF5] : ",p.value);const n={},c=e.channelInfo;n.ticketEntityId=p.value,n.typeCode=Q,c.callInfo.extraData.ucid&&(n.extraData=c.callInfo.extraData.ucid),n.contactCode=z,n.startDate=g(e.expiredDate),n.key=a.callId,k.saveTicketChannel(n).then(o=>{o.status===200&&(u.value=o.data.entityId,console.log("[\uD2F0\uCF13 \uCC44\uB110 \uBC1C\uD589] : ",u.value),I.getTicketByEntityId(p.value).then(s=>{s.status===200&&(console.log("[\uD2F0\uCF13 \uC0C1\uC138\uC815\uBCF4 \uC870\uD68C] : ",p.value),T.value=s.data)}).catch(s=>{s.response.status===400&&s.response.data.message&&showAlert(s.response.data.message),console.log(s)}))}).catch(o=>{o.response.status===400&&o.response.data.message&&showAlert(o.response.data.message),console.log(o)})}}).catch(l=>{l.response.status===400&&l.response.data.message&&showAlert(l.response.data.message),console.log(l)}))}function w(e){if(!u.value)return;const t={};t.endDate=g(e.expiredDate),k.updateTicketChannel(u.value,t).then(a=>{a.status===200&&console.log("[\uD2F0\uCF13 \uCC44\uB110 \uC885\uB8CC\uC2DC\uAC04 \uCD94\uAC00] : ",u.value)}).catch(a=>{a.response.status===400&&a.response.data.message&&showAlert(a.response.data.message),console.log(a)})}function U(e){if(!u.value)return;const t={};t.processDate=g(e.expiredDate),k.updateTicketChannel(u.value,t).then(a=>{a.status===200&&(console.log("[\uD2F0\uCF13 \uCC44\uB110 \uD6C4\uCC98\uB9AC\uC2DC\uAC04 \uCD94\uAC00] : ",u.value),u.value=null)}).catch(a=>{a.response.status===400&&a.response.data.message&&showAlert(a.response.data.message),console.log(a)})}async function G(e){var o,s,A,L,V,R,P,F,$,B;const t={typeCode:((o=v.codes.get(e.typeCode))==null?void 0:o.name)||null,entityId:e.entityId||null,statusCode:((s=v.codes.get(e.statusCode))==null?void 0:s.name)||null,inChannel:null,outChannel:null,counselCategoryCode:((A=v.codes.get(e.counselCategoryCode))==null?void 0:A.name)||null,inboundPath:e.inboundPath||null,counselTypeCodeLarge:((L=_.counselTypes.get(e.counselTypeCodeLarge))==null?void 0:L.name)||null,counselTypeCodeMedium:((V=_.counselTypes.get(e.counselTypeCodeMedium))==null?void 0:V.name)||null,counselTypeCodeSmall:((R=_.counselTypes.get(e.counselTypeCodeSmall))==null?void 0:R.name)||null,contents:e.contents||null,reservationDate:null,reservationTime:null,createdByUserName:e.createdByUserName||null,managerUserName:e.managerUserName||null,createdDate:e.createdDate||null,lastModifiedDate:e.lastModifiedDate||null,customerName:e.customerName||null,tel:e.tel||null};((P=e.channels)==null?void 0:P.length)&&e.channels[0].contactCode===Y&&(t.inChannel=(F=v.codes.get(e.channels[0].typeCode))==null?void 0:F.name),(($=e.channels)==null?void 0:$.length)&&e.channels[0].contactCode===z&&(t.outChannel=(B=v.codes.get(e.channels[0].typeCode))==null?void 0:B.name);function a(){if(e.callbackReservationDate){const[h,M]=e.callbackReservationDate.split(" "),J=M?M.substring(0,5):"";t.reservationDate=h,t.reservationTime=J}}a(),x.value=t;const i=e.entityId,l=100*C.value.length,n=100*C.value.length;C.value.forEach(h=>{h.closed||h.focus()});const c=window.open("/view/ticketDetail",i,`width=400,height=680,left=${l},top=${n}`);c?(C.value.push(c),c.addEventListener("unload",()=>{setTimeout(()=>{c.closed&&(C.value=C.value.filter(h=>h!==c))},100)}),c.focus()):console.error("\uD31D\uC5C5\uC774 \uCC28\uB2E8\uB418\uC5C8\uAC70\uB098 \uC5F4\uB9AC\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.")}return(e,t)=>(ue(),de("div",be,[d("div",Ee,[d("div",Se,[d("div",xe,[d("div",Ne,[m(H,{title:"\uC778\uBC14\uC6B4\uB4DC \uC0C1\uB2F4\uD604\uD669",class:"col-auto"}),t[2]||(t[2]=d("div",{class:"a-border col bound-border row flex-center"},[d("span",null,"234")],-1))]),d("div",Oe,[m(H,{title:"\uC544\uC6C3\uBC14\uC6B4\uB4DC \uC0C1\uB2F4\uD604\uD669",class:"col-auto"}),t[3]||(t[3]=d("div",{class:"a-border col bound-border row flex-center"},[d("span",null,"134")],-1))])]),d("div",we,[m(pe(De),{options:j.value,data:W.value},null,8,["options","data"])])]),d("div",Ue,[m(ae,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=a=>y.value=a),class:"col-auto full-width"},{default:b(()=>[m(te,{name:"ticketLog",label:"\uD2F0\uCF13\uC774\uB825"})]),_:1},8,["modelValue"]),m(Z,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=a=>y.value=a),"keep-alive":"",class:"col"},{default:b(()=>[m(X,{name:"ticketLog",class:"q-pa-xs"},{default:b(()=>[m(oe,{onRowClick:G,ref_key:"grid",ref:S},null,512)]),_:1})]),_:1},8,["modelValue"])])]),m(le,{class:"col-auto full-height","new-ticket":T.value,onUpdate:D},null,8,["new-ticket"])]))}},Ut=re(Ae,[["__scopeId","data-v-2f5e680c"]]);export{Ut as default};
