import{u as j}from"./codeStore.e69f9e04.js";import{u as K}from"./counselTypeStore.5faa86f9.js";import{u as b}from"./permissionStore.29c18612.js";import{t as m}from"./ticketApi.d3774daa.js";import O from"./TabulatorGrid.9c80b09d.js";import{s as U,a as Y}from"./dialog.88ce899f.js";import{h as g}from"./errorHandler.5efe1eb1.js";import{F as q}from"./FlowRoleCode.12cdb02e.js";import G from"./ALoadingSpinner.ca275fb8.js";import{F as J}from"./FlowSystemCode.7be7ce49.js";import{r as l,g as Q,y as W,t as X,o as Z,Y as ee,a as H}from"./index.02f7c95d.js";import"./axios.816e1a60.js";import"./header.10137493.js";import"./permissionApi.ffe0b82d.js";import"./CommonPopup.2b0ee10b.js";import"./use-dialog-plugin-component.234e0905.js";import"./authStore.fadf8446.js";import"./counsel-hub.145170b4.js";import"./_plugin-vue_export-helper.cdc0426e.js";const te={class:"column fit no-wrap"},ae="/rest/api/v1/ticket/tickets",Te={__name:"TicketManageTable",emits:["rowSelected","rowDeselected","rowDeleted","hasDatas"],setup(ne,{expose:E,emit:V}){const s=l(),d=V;E({deleteTicket:x,loadInitialData:w,searchTickets:R,setData:A});const v=J.TICKET_TYPE.COUNSEL_TICKET,p=j(),z=K(),I=b(),T=Q(()=>I.hasPermission(q.TICKET_ROLE.READ)),C=l(null),u=l(!1),N=[{formatter:"rowSelection",titleFormatter:null,hozAlign:"center",headerHozAlign:"center",headerSort:!1,width:20,resizable:!1},{title:"\uD2F0\uCF13\uBC88\uD638",field:"entityId",headerHozAlign:"center",hozAlign:"center"},{title:"\uCC98\uB9AC\uC0C1\uD0DC",field:"statusCode",headerHozAlign:"center",hozAlign:"center",formatter:function(e){var a,n;const t=e.getValue()||null;return(n=(a=p.codes.get(t))==null?void 0:a.name)!=null?n:t}},{title:"\uD2F0\uCF13\uC720\uD615",field:"typeCode",headerHozAlign:"center",hozAlign:"center",formatter:function(e){var a,n;const t=e.getValue()||null;return(n=(a=p.codes.get(t))==null?void 0:a.name)!=null?n:t}},{title:"\uC0C1\uB2F4\uAD6C\uBD84",field:"counselCategoryCode",headerHozAlign:"center",hozAlign:"center",formatter:function(e){var a,n;const t=e.getValue()||null;return(n=(a=p.codes.get(t))==null?void 0:a.name)!=null?n:t}},{title:"\uBC1C\uD589\uC77C\uC2DC",field:"createdDate",headerHozAlign:"center",hozAlign:"center"},{title:"\uC0C1\uB2F4\uC720\uD615(\uB300)",field:"counselTypeCodeLarge",headerHozAlign:"center",hozAlign:"left",formatter:function(e){var a,n;const t=e.getValue()||null;return(n=(a=z.counselTypes.get(t))==null?void 0:a.name)!=null?n:t}},{title:"\uC0C1\uB2F4\uC720\uD615(\uC911)",field:"counselTypeCodeMedium",headerHozAlign:"center",hozAlign:"left",formatter:function(e){var a,n;const t=e.getValue()||null;return(n=(a=z.counselTypes.get(t))==null?void 0:a.name)!=null?n:t}},{title:"\uC0C1\uB2F4\uC720\uD615(\uC18C)",field:"counselTypeCodeSmall",headerHozAlign:"center",hozAlign:"left",formatter:function(e){var a,n;const t=e.getValue()||null;return(n=(a=z.counselTypes.get(t))==null?void 0:a.name)!=null?n:t}},{title:"\uC804\uD654\uBC88\uD638",field:"tel",headerHozAlign:"center",hozAlign:"center"},{title:"\uB2F4\uB2F9\uC790",field:"managerUserName",headerHozAlign:"center",hozAlign:"center",formatter:function(e){const t=e.getData();return t.managerUserName&&t.managerUserId?t.managerUserName+` [${t.managerUserId}]`:null}},{title:"\uBCF4\uACE0\uC790",field:"createdByUserName",headerHozAlign:"center",hozAlign:"center",formatter:function(e){const t=e.getData();return t.createdByUserName&&t.createdByUserId?t.createdByUserName+` [${t.createdByUserId}]`:null}}],c=l([]),r=l(0),f=l(100),h=l(!1),D=l(S(F(new Date))),y=l(S(M(new Date))),o=l({page:r.value,size:f.value,fromCreatedDate:D.value,toCreatedDate:y.value,"entity.typeCode":v});W(()=>{w()}),X(c,e=>{e.length?d("hasDatas",!0):d("hasDatas",!1)});function $(e){d("rowSelected",e)}function B(){d("rowDeselected")}function F(e){const t=new Date(e);return t.setMonth(e.getMonth()-1),t}function M(e){const t=new Date(e);return t.setDate(e.getDate()+1),t}function S(e){e.setHours(0,0,0,0);const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n} 00:00:00`}async function P(){if(!u.value&&!h.value){o.value={...o.value,page:r.value};try{const e=await m.getTicket(o.value);e.status===200&&(c.value=[...c.value,...e.data.content],h.value=e.data.last,r.value+=1)}catch(e){g(e)}}}function R(e){if(!T.value){U("\uD2F0\uCF13 \uC870\uD68C \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}if(u.value)o.value={...e},A();else return s.value=!0,r.value=0,o.value={page:r.value,size:f.value,...e},m.getTicket(o.value).then(t=>{t&&t.data&&(c.value=t.data.content,h.value=t.data.last,r.value+=1)}).catch(t=>{g(t)}).finally(()=>{s.value=!1})}function w(){if(!T.value){U("\uD2F0\uCF13 \uC870\uD68C \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}u.value?o.value={fromCreatedDate:D.value,toCreatedDate:y.value,"entity.typeCode":v}:(s.value=!0,r.value=0,o.value={page:r.value,size:f.value,fromCreatedDate:D.value,toCreatedDate:y.value,"entity.typeCode":v},m.getTicket(o.value).then(e=>{e.status===200&&(c.value=e.data.content,h.value=e.data.last,r.value+=1)}).catch(e=>{g(e)}).finally(()=>{s.value=!1}))}function x(e){!e||Y("\uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?").then(t=>{t&&m.deleteTicket(e).then(a=>{a.status===200&&(w(),u.value&&A(),d("rowDeleted"))}).catch(a=>{g(a)})})}function L(e,t,a){return o.value={...o.value,page:a.page-1,size:a.size||f.value,isPaging:!0},new Promise(function(n,_){m.getTicket(o.value).then(i=>{if(i.status===200){const k={data:i.data.content,last_page:i.data.totalPages,last_row:i.data.totalElements};n(k)}}).catch(i=>{g(i),_(i)})})}function A(){u.value&&C.value.setData()}return(e,t)=>(Z(),ee("div",te,[H(O,{rows:c.value,columns:N,onRowSelected:$,onRowDeselected:B,"selectable-rows":1,"infinite-scroll":P,"ajax-url":ae,"ajax-request-func":L,pagination:u.value,"pagination-size":f.value,ref_key:"grid",ref:C,class:"col full-width"},null,8,["rows","pagination","pagination-size"]),H(G,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=a=>s.value=a)},null,8,["modelValue"])]))}};export{Te as default};
