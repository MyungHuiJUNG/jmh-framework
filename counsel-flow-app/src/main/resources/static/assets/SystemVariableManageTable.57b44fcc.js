import E from"./ABtn.e24d7e8a.js";import I from"./TabulatorGrid.9c80b09d.js";import{u as k,s as h}from"./systemVariableStore.28d075a0.js";import{u as x}from"./permissionStore.29c18612.js";import{s}from"./dialog.88ce899f.js";import{h as _}from"./errorHandler.5efe1eb1.js";import D from"./ATitleBar.bbf1d9a4.js";import{F as g}from"./FlowRoleCode.12cdb02e.js";import M from"./ALoadingSpinner.ca275fb8.js";import{_ as z}from"./_plugin-vue_export-helper.cdc0426e.js";import{g as y,r as c,y as B,o as v,Y as L,a as d,z as P,c as N,Z as T}from"./index.02f7c95d.js";/* empty css                                                             */import"./axios.816e1a60.js";import"./header.10137493.js";import"./permissionApi.ffe0b82d.js";import"./CommonPopup.2b0ee10b.js";import"./use-dialog-plugin-component.234e0905.js";import"./authStore.fadf8446.js";import"./counsel-hub.145170b4.js";import"./ClosePopup.daa62b28.js";const C={class:"fit column"},$={class:"row full-width justify-end q-pa-xs q-gutter-xs bg-grey-5 a-border"},q={__name:"SystemVariableManageTable",setup(H){const b=k(),u=x(),V=y(()=>u.hasPermission(g.VARIABLE_ROLE.READ)),A=y(()=>u.hasPermission(g.VARIABLE_ROLE.SAVE)),f=c(null),m=c([]),i=c(!1),w=[{title:"\uC2DC\uC2A4\uD15C\uBCC0\uC218\uBA85",field:"displayName",hozAlign:"left",headerHozAlign:"center",headerSort:!1},{title:"\uAC12",field:"value",hozAlign:"left",headerHozAlign:"center",headerSort:!1,editor:"adaptable",editorParams:{editorLookup:function(e){return e.getRow().getData().editType==="select"?"list":"input"},paramsLookup:function(e,t){const a=t.getRow().getData().editItem,n=a?a.split(",").map(o=>o.trim()):[];if(e==="list")return{values:n}}},editable:function(e){return e.getRow().getData().value!==null},cellEdited:function(e){const t=e.getRow().getData();t._isModified=!0}},{title:"\uC124\uBA85",field:"description",hozAlign:"left",headerHozAlign:"center",headerSort:!1}];async function p(){if(!V.value){s("\uC2DC\uC2A4\uD15C\uBCC0\uC218 \uC870\uD68C \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}i.value=!0;try{const e=await h.getSystemVariable();if(e.status===200){let t=function(l){return Array.isArray(l)?l.map(a=>(a.children&&a.children.length===0?delete a.children:a.children&&(a.children=t(a.children)),a)):l};m.value=t(e.data)}}catch(e){_(e)}finally{i.value=!1}}function S(){const e=f.value.getData(),t=[];let l=!1;function a(o){o.forEach(r=>{r._isModified&&(r.value===null||r.value.trim()===""?(s(`'${r.displayName}'\uC758 \uAC12\uC774 \uACF5\uBC31\uC785\uB2C8\uB2E4. \uAC12\uC744 \uC785\uB825\uD574 \uC8FC\uC138\uC694.`),l=!0):r.value.trim().length>1024?(s("\uAC12\uC740 1024\uC790\uB97C \uCD08\uACFC\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."),l=!0):t.push(r)),r.children&&r.children.length>0&&a(r.children)})}if(a(e),l)return;if(t.length===0){s("\uC218\uC815\uB41C \uBA54\uB274\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.");return}const n=t.map(o=>{const r=o.entityId;if(!r)return Promise.resolve();const R={entity:{value:o.value,description:o.description}};return h.putSystemVariable(r,R).then(()=>{o._isModified=!1}).catch(F=>{s(`\uC2DC\uC2A4\uD15C\uBCC0\uC218 '${o.displayName}' \uC5C5\uB370\uC774\uD2B8 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.`)})});Promise.all(n).then(()=>{s("\uC2DC\uC2A4\uD15C\uBCC0\uC218\uAC00 \uC131\uACF5\uC801\uC73C\uB85C \uC800\uC7A5\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),p(),b.load()}).catch(o=>{_(o)})}return B(()=>p()),(e,t)=>(v(),L("div",C,[d(D,{title:"\uC2DC\uC2A4\uD15C \uBCC0\uC218 \uBAA9\uB85D",class:"col-auto full-width q-mb-xs"}),d(I,{ref_key:"gridRef",ref:f,rows:m.value,columns:w,reactiveData:!1,class:"col full-width",dataTree:!0,dataTreeStartExpanded:!0,selectableRows:1},null,8,["rows"]),P("div",$,[A.value?(v(),N(E,{key:0,label:"\uC800\uC7A5",onClick:S})):T("",!0)]),d(M,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=l=>i.value=l)},null,8,["modelValue"])]))}},ce=z(q,[["__scopeId","data-v-4cde1404"]]);export{ce as default};
