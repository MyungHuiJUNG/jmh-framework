import{Q as x}from"./QMenu.3c9cf304.js";import O from"./TabulatorGrid.9c80b09d.js";import{u as U}from"./codeStore.e69f9e04.js";import{n as c}from"./notificationApi.e49dbc1e.js";import{s as z}from"./dialog.88ce899f.js";import{u as D,h as d,M as m}from"./errorHandler.5efe1eb1.js";import{F as r}from"./FlowSystemCode.7be7ce49.js";import{u as V}from"./use-quasar.2d4ce40a.js";import k from"./NotificationMessagePopup.f5b848b3.js";import{_ as G}from"./_plugin-vue_export-helper.cdc0426e.js";import{aD as A,X as H,r as P,o as R,c as F,w as $,z as Q,a as Y}from"./index.02f7c95d.js";import"./position-engine.53490cc8.js";import"./axios.816e1a60.js";import"./header.10137493.js";import"./CommonPopup.2b0ee10b.js";import"./use-dialog-plugin-component.234e0905.js";import"./authStore.fadf8446.js";import"./counsel-hub.145170b4.js";import"./QBadge.c1f4e948.js";import"./ATitleBar.bbf1d9a4.js";import"./ClosePopup.daa62b28.js";import"./ABtn.e24d7e8a.js";/* empty css                                                             */import"./AInput.398f059b.js";import"./ATextarea.94103f28.js";/* empty css                                                                  */import"./UserPopup.4dc2e487.js";import"./ACheckbox.923db872.js";import"./ASelect.a02a29e0.js";import"./QItem.1bce08e7.js";import"./QSelect.b17c746f.js";import"./rtl.276c3f1b.js";import"./format.2cae61da.js";import"./organizationStore.a86bd6ff.js";import"./userApi.abe7b8c8.js";import"./ALoadingSpinner.ca275fb8.js";const B={class:"a-border q-pa-xs popup-size column"},L={__name:"NotificationAlarmMenu",props:A({rows:{type:Array,default:()=>[]}},{modelValue:{},modelModifiers:{}}),emits:A(["notificatioUpdate"],["update:modelValue"]),setup(u,{emit:E}){const M=V(),n=H(u,"modelValue"),_=U(),h=D(),g=P(null),s=E,y=u,S=[{title:"\uC54C\uB9BC\uAD6C\uBD84",field:"typeCode",headerHozAlign:"center",hozAlign:"center",headerSort:!1,width:100,formatter:function(e){var i,o;const t=e.getValue()||null;return(o=(i=_.codes.get(t))==null?void 0:i.name)!=null?o:t}},{title:"\uBA54\uC2DC\uC9C0",field:"message",headerHozAlign:"center",hozAlign:"center",headerSort:!1,formatter:function(e){const t=e.getData();return t.typeCode===r.NOTIFICATION_TYPE.MESSAGE?t.title:t.message}},{title:"\uC218\uC2E0",field:"sendTime",headerHozAlign:"center",hozAlign:"center",headerSort:!1,width:130,formatter:e=>{const t=e.getValue(),i=new Date(t),l=new Date-i,a=Math.floor(l/1e3),p=Math.floor(a/60),f=Math.floor(p/60),C=Math.floor(f/24);return a<60?`${a}\uCD08 \uC804`:p<60?`${p}\uBD84 \uC804`:f<24?`${f}\uC2DC\uAC04 \uC804`:`${C}\uC77C \uC804`}},{title:'<button style="height: 24px; padding: 0px 8px; min-height: 0; margin: 0;" >\uC804\uCCB4\uC0AD\uC81C</button>',field:"delete",headerHozAlign:"center",hozAlign:"center",headerSort:!1,formatter:e=>{const t=document.createElement("button");return t.innerText="\uC0AD\uC81C",t.style.height="21px",t.style.minHeight="0px",t.style.padding="0px 8px",t.addEventListener("click",i=>{i.stopPropagation();const o=e.getData().entityId;N(o)}),t},headerClick:()=>T(),width:90}];function T(){const t=g.value.getRows().map(o=>o.getData().entityId);if(t.length===0){z("\uC0AD\uC81C\uD560 \uC54C\uB9BC\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}const i=t.map(o=>({entityId:o}));c.updateMultipleNotifications(i).then(o=>{o.status===200&&s("notificatioUpdate")}).catch(o=>{d(o)})}function N(e){c.updateNotification(e).then(t=>{t.status===200&&s("notificatioUpdate")}).catch(t=>{d(t)})}function b(e){var l;const t=e.typeCode,i=JSON.parse(e.jsonStringContent),o=(l=i.notification)==null?void 0:l.entityId;t===r.NOTIFICATION_TYPE.MESSAGE?(I(),c.updateNotification(o).then(a=>{a.status===200&&(s("notificatioUpdate"),M.dialog({component:k,componentProps:{componentType:"read",data:i.notification}}),n.value=!1)}).catch(a=>{d(a)})):t===r.NOTIFICATION_TYPE.REQUEST&&(v(),c.updateNotification(e.entityId).then(a=>{a.status===200&&(s("notificatioUpdate"),n.value=!1)}).catch(a=>{d(a)}))}function I(){h.addTab({name:m.MESSAGE_MANAGE.name,label:m.MESSAGE_MANAGE.label})}function v(){h.addTab({name:m.USER_MANAGE.name,label:m.USER_MANAGE.label})}function w(e){const t=e.getData();t.typeCode===r.NOTIFICATION_TYPE.MESSAGE||t.typeCode===r.NOTIFICATION_TYPE.REQUEST?e.getElement().classList.add("tabulator-hover-clickable"):e.getElement().classList.remove("tabulator-hover-clickable")}return(e,t)=>(R(),F(x,{anchor:"bottom middle",self:"top middle",modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=i=>n.value=i),"no-parent-event":"",onHide:t[1]||(t[1]=i=>n.value=!1)},{default:$(()=>[Q("div",B,[Y(O,{ref_key:"grid",ref:g,rows:y.rows,columns:S,class:"bg-grey-4 col fit",placeholder:"\uC54C\uB9BC\uC774 \uC874\uC7AC\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.","placeholder-color":"#555","row-formatter":w,onRowDblClick:b},null,8,["rows"])])]),_:1},8,["modelValue"]))}},Ct=G(L,[["__scopeId","data-v-245c9cdd"]]);export{Ct as default};
