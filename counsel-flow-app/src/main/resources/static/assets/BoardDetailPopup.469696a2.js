import{Q as U}from"./QBadge.c1f4e948.js";import{r as n,g as J,y as Ce,o as s,c as y,w as R,F as Re,a as r,z as o,a0 as k,Y as c,a1 as m,Z as u,B as W,az as De,ab as Ie,Q as je}from"./index.02f7c95d.js";import{b as g}from"./BoardCategory.e55ffcf3.js";import{u as Be,c as Ee}from"./BoardCatagoryManagePopup.4c280645.js";import{F as Se,f as X}from"./FileUploadManage.e1cb862f.js";import Me from"./ATitleBar.bbf1d9a4.js";import $ from"./AInput.398f059b.js";import f from"./ABtn.e24d7e8a.js";import Ve from"./BoardCategoryRegist.79478ab1.js";import{u as Ue}from"./utils.32a0767f.js";import{u as ee}from"./use-dialog-plugin-component.234e0905.js";import{u as $e}from"./use-quasar.2d4ce40a.js";import{u as ze}from"./permissionStore.29c18612.js";import{s as B,a as E}from"./dialog.88ce899f.js";import{h as p}from"./errorHandler.5efe1eb1.js";import{F as Pe}from"./FlowRoleCode.12cdb02e.js";import te from"./ATextEditor.d38287bf.js";import{_ as Ae}from"./_plugin-vue_export-helper.cdc0426e.js";import"./QTree.ce7bbb93.js";import"./QSlideTransition.b1b1fe3f.js";import"./QTooltip.86ca1c0e.js";import"./position-engine.53490cc8.js";import"./axios.816e1a60.js";import"./header.10137493.js";import"./app-util.f29d8347.js";import"./TabulatorGrid.9c80b09d.js";import"./BoardCategoryMovePopup.1a199b96.js";import"./CommonPopup.2b0ee10b.js";import"./ClosePopup.daa62b28.js";/* empty css                                                             */import"./permissionApi.ffe0b82d.js";import"./authStore.fadf8446.js";import"./counsel-hub.145170b4.js";const Oe={class:"col column full-width q-pa-xs"},Ne={class:"col-auto row full-width fixed-height"},Qe={class:"col-auto t-column text-left top-border-left q-px-xs column justify-center"},Ke={class:"row"},Le={key:0,class:"col top-border-right justify-center column q-px-xs"},Te={class:"full-width text-ellipsis"},He={key:1,class:"col top-border-right justify-center column q-px-xs"},Ye={class:"col-auto row fixed-height full-width"},Ze={class:"col-auto t-column bottom-border-left text-left q-px-xs column justify-center"},Ge={class:"row"},Je={key:0,class:"col bottom-border-left body-border-right justify-center column q-px-xs"},We={class:"full-width text-ellipsis"},Xe={key:1,class:"col body-border-left body-border-right justify-center text-center column"},et={class:"row justify-between items-center"},tt={class:"q-ml-xs"},ot={class:"col row full-width"},lt={class:"col-auto t-column text-left body-border-left q-px-xs column justify-center"},st={class:"row"},nt={key:0,class:"col body-border-right q-pa-xs no-wrap text-no-wrap full-height"},it={key:1,class:"col body-border-right q-pa-xs no-wrap text-no-wrap full-height"},at={class:"col-2 row full-width"},rt={class:"col body-border-right q-pa-xs no-wrap text-no-wrap full-height column"},ct={class:"row items-center col-auto full-width"},ut={class:"col full-width",style:{"overflow-y":"auto"}},dt={class:"col column"},mt={class:"full-width text-ellipsis text-bold"},ft={key:0},pt={key:1},vt={class:"full-width text-ellipsis",style:{"word-break":"break-word","white-space":"normal"}},yt={class:"col-auto"},ht={key:0,class:"col-auto full-width q-my-xs",style:{"border-top":"1px solid #ddd"}},gt={key:0,class:"col-auto row full-width"},xt={class:"col body-border-right justify-center column q-pa-xs"},_t={class:"col-2 row"},bt={class:"col body-border-right justify-center no-wrap text-no-wrap overflow-auto full-height"},wt={key:0},kt={key:1},qt={class:"col-auto row fixed-height"},Ft={class:"col body-border-left text-center justify-center column"},Ct={class:"col body-border-right text-center justify-center column"},Rt={class:"col-auto row fixed-height"},Dt={class:"col body-border-left text-center justify-center column"},It={class:"col body-border-right text-center justify-center column"},jt={class:"col-auto full-width text-right bg-grey-5 a-border q-pa-xs"},Bt={__name:"BoardDetailPopup",props:{propData:Object},emits:[...ee.emits],setup(oe,{emit:Et}){const le=$e(),z=Be(),se=ze(),v=oe,{dialogRef:ne,onDialogOK:P,onDialogHide:St}=ee(),i=n(!1),A=n(""),S=n(""),O=n(""),q=n(""),D=n(""),N=n(""),Q=n(""),K=n(""),L=n(""),h=n(""),M=n(""),x=n(""),T=n(),_=n(),ie=J(()=>Ue.removeHtmlTagsIncludingImg(_.value)),H=n({}),I=new Map,b=n([]),w=n([]),F=n([]),C=n([]),ae=J(()=>se.hasPermission(Pe.BOARD_ROLE.SAVE)),V=n(!1);function re(e){if(S.value=e.title,e.category&&e.category.path){const l=e.category.path.split(".").map(a=>{const d=z.categories.get(a);return d?d.name:a});q.value=l.join(" > ")}else q.value="\uC804\uCCB4";if(D.value=e.content,N.value=e.createdByUser.name,Q.value=e.createdDate,K.value=e.modifiedByUser.name,L.value=e.lastModifiedDate,console.log("\uAC8C\uC2DC\uD310\uC0C1\uC138\uC815\uBCF4",e),e.files&&e.files.length>0)for(const t of e.files)b.value.push(t)}function ce(){le.dialog({component:Ve}).onOk(e=>{O.value=e,Ee.getCategory(e).then(t=>{const a=t.data.path.split(".").map(d=>{const G=z.categories.get(d);return G?G.name:d});q.value=a.join(" > ")}).catch(t=>{p(t)})})}function ue(){x.value=S.value,T.value=D.value,_.value=D.value,i.value=!0,C.value=[]}function de(){i.value=!1}function j(e){g.getReply(e).then(t=>{M.value=t.data.map(l=>({...l,isEditing:!1,originalContents:l.contents}))}).catch(t=>{p(t)})}function Y(){if(!h.value||h.value.trim()===""){B("\uB313\uAE00\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.");return}const e={"entity.board.entityId":v.propData.entityId,"entity.contents":h.value};g.addReply(e).then(t=>{h.value="",j(v.propData.entityId)}).catch(t=>{p(t)})}async function me(e){await E("\uB313\uAE00\uC744 \uC0AD\uC81C \uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")&&g.removeReply(e).then(l=>{j(v.propData.entityId)}).catch(l=>{p(l)})}function fe(e){e.isEditing=!0}function Z(e){if(!e.contents||e.contents.trim()===""){B("\uB313\uAE00\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.");return}const t={"entity.contents":e.contents};g.updateReply(t,e.entityId).then(l=>{e.isEditing=!1,e.originalContents=e.contents,j(v.propData.entityId)}).catch(l=>{p(l)})}function pe(e){e.contents=e.originalContents,e.isEditing=!1}function ve(){h.value=""}function ye(){if(!x.value||x.value.trim()===""){B("\uC81C\uBAA9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.");return}if(!_.value||_.value.trim()===""){B("\uB0B4\uC6A9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.");return}const e={title:x.value,content:encodeURIComponent(_.value),rawContent:encodeURIComponent(ie.value),categoryId:O.value};g.updateBoard(v.propData.entityId,e).then(t=>{xe(v.propData.entityId),H.value.type="update",P(H.value)}).catch(t=>{p(t)})}function he(){E("\uD574\uB2F9 \uAC8C\uC2DC\uAE00\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?").then(e=>{e&&g.deleteBoard(v.propData.entityId).then(t=>{P({type:"delete"})}).catch(t=>{p(t)})})}function ge(e){const t=e.target.files;w.value.push(...t),_e(),A.value.value=null}function xe(e){var t;if((t=F.value)!=null&&t.length&&X.uploadFile("board",e,be()).then(l=>{console.log("\uD30C\uC77C\uC5C5\uB85C\uB4DC",l)}).catch(l=>{p(l)}),C.value){let l="";for(const a in C.value)a>0&&(l+=","),l+=C.value[a].entityId;X.removeFiles(l).then(a=>{console.log("removefiles",a)}).catch(a=>{p(a)})}}function _e(){I.clear(),b.value.forEach(e=>{const t=`${e.fileName}-${e.fileSize}`;I.set(t,e)}),w.value=w.value.filter(e=>{const t=`${e.name}-${e.size}`;return I.has(t)?!1:(I.set(t,e),!0)}),F.value=[],F.value=w.value}function be(){console.log("\uC5C5\uB85C\uB4DC\uD560 \uD30C\uC77C\uC740?",F.value);const e=new FormData;return F.value.forEach(t=>{e.append("file",t)}),e}function we(e){E("\uD574\uB2F9 \uD30C\uC77C\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?").then(t=>{t&&w.value.splice(e,1)})}function ke(e,t){E("\uD574\uB2F9 \uD30C\uC77C\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?").then(l=>{l&&(console.log("\uC0AD\uC81C\uD560 \uD30C\uC77C",e),C.value.push(e),b.value.splice(t,1))})}const qe=()=>{const e=document.querySelector(".dialog-body");V.value?(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),V.value=!1):(e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),V.value=!0)};Ce(()=>{g.getBoard(v.propData.entityId).then(e=>{re(e.data),j(v.propData.entityId)}).catch(e=>{p(e)})});function Fe(e){_.value=e}return(e,t)=>(s(),y(Re,{ref_key:"dialogRef",ref:ne,"no-backdrop-dismiss":"","transition-show":"fade","transition-hide":"fade",class:"column no-wrap","allow-focus-outside":""},{default:R(()=>[r(je,{class:"dialog-body column no-wrap fit"},{default:R(()=>[r(Me,{class:"col-auto full-width",title:"\uAC8C\uC2DC\uAE00 \uC0C1\uC138\uB0B4\uC6A9",maximize:!0,close:!0,onMaximize:qe}),o("div",Oe,[o("div",Ne,[o("div",Qe,[o("div",Ke,[r(U,{class:"q-pa-none q-mr-xs",color:"grey-2","text-color":"red"},{default:R(()=>t[2]||(t[2]=[k("*")])),_:1}),t[3]||(t[3]=k("\uC81C\uBAA9"))])]),i.value?u("",!0):(s(),c("div",Le,[o("span",Te,m(S.value),1)])),i.value?(s(),c("div",He,[r($,{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=l=>x.value=l)},null,8,["modelValue"])])):u("",!0)]),o("div",Ye,[o("div",Ze,[o("div",Ge,[r(U,{class:"q-pa-none q-mr-xs",color:"grey-2","text-color":"red"},{default:R(()=>t[4]||(t[4]=[k("*")])),_:1}),t[5]||(t[5]=k("\uCE74\uD14C\uACE0\uB9AC "))])]),i.value?u("",!0):(s(),c("div",Je,[o("span",We,m(q.value),1)])),i.value?(s(),c("div",Xe,[o("div",et,[o("span",tt,m(q.value),1),r(f,{label:"\uC120\uD0DD",class:"q-mx-xs",onClick:ce})])])):u("",!0)]),o("div",ot,[o("div",lt,[o("div",st,[r(U,{class:"q-pa-none q-mr-xs",color:"grey-2","text-color":"red"},{default:R(()=>t[6]||(t[6]=[k("*")])),_:1}),t[7]||(t[7]=k("\uB0B4\uC6A9"))])]),i.value?(s(),c("div",it,[r(te,{class:"fit column no-wrap","content-input":T.value,onContentOutput:Fe},null,8,["content-input"])])):(s(),c("div",nt,[r(te,{class:"fit column no-wrap","content-input":D.value,readOnly:!0},null,8,["content-input"])]))]),o("div",at,[t[8]||(t[8]=o("div",{class:"col-auto t-column text-left body-border-left q-px-xs column justify-center full-height"},[o("div",{class:"row"},"\uB313\uAE00")],-1)),o("div",rt,[o("div",ct,[r($,{class:"col full-width",modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=l=>h.value=l),onKeyup:W(Y,["enter"])},null,8,["modelValue"]),r(f,{class:"col-auto reply-btn q-ml-xs",icon:"edit",onClick:Y}),r(f,{class:"col-auto reply-btn q-ml-xs",icon:"delete",onClick:ve})]),o("div",ut,[(s(!0),c(Ie,null,De(M.value,(l,a)=>(s(),c("div",{key:a,class:"row justify-between items-center"},[o("div",dt,[o("span",mt,m(l.createdByUserName)+" ["+m(l.createdByUserId)+"] - "+m(l.createdDate),1),l.isEditing?(s(),c("div",ft,[r($,{class:"full-width",modelValue:l.contents,"onUpdate:modelValue":d=>l.contents=d,onKeyup:W(d=>Z(l),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])):(s(),c("div",pt,[o("span",vt,m(l.contents),1)]))]),o("div",yt,[l.isEditing?(s(),y(f,{key:0,class:"col-auto reply-btn q-ml-xs",icon:"save",onClick:d=>Z(l)},null,8,["onClick"])):u("",!0),l.isEditing?(s(),y(f,{key:1,class:"col-auto reply-btn q-ml-xs",icon:"cancel",onClick:d=>pe(l)},null,8,["onClick"])):(s(),y(f,{key:2,class:"col-auto reply-btn q-ml-xs",icon:"edit",onClick:d=>fe(l)},null,8,["onClick"])),r(f,{icon:"delete",color:"primary",onClick:d=>me(l.entityId),class:"col-auto reply-btn q-ml-xs"},null,8,["onClick"])]),a<M.value.length-1?(s(),c("div",ht)):u("",!0)]))),128))])])]),i.value?(s(),c("div",gt,[t[9]||(t[9]=o("div",{class:"col-auto t-column text-left body-border-left q-px-xs column justify-center"},"\uCCA8\uBD80\uD30C\uC77C",-1)),o("div",xt,[o("input",{type:"file",onChange:ge,multiple:"",ref_key:"fileInput",ref:A},null,544)])])):u("",!0),o("div",_t,[t[11]||(t[11]=o("div",{class:"col-auto t-column text-left body-border-left q-px-xs column justify-center full-height"}," \uD30C\uC77C\uBAA9\uB85D ",-1)),o("div",bt,[!i.value&&!b.value.length?(s(),c("div",wt,t[10]||(t[10]=[o("span",null," \uB4F1\uB85D\uB41C \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. ",-1)]))):u("",!0),i.value||b.value.length?(s(),y(Se,{key:1,filesFromServer:b.value,tempLocalFiles:w.value,resourceType:"Board",isModify:i.value,onRemoveFile:we,onRemoveServerFile:ke},null,8,["filesFromServer","tempLocalFiles","isModify"])):u("",!0)])]),i.value?u("",!0):(s(),c("div",kt,[o("div",qt,[t[12]||(t[12]=o("div",{class:"col-auto t-column text-center body-border-left q-px-xs column justify-center"},"\uB4F1\uB85D\uC790",-1)),o("div",Ft,m(N.value),1),t[13]||(t[13]=o("div",{class:"col-auto t-column text-center body-border-left q-px-xs column justify-center"},"\uB4F1\uB85D\uC77C\uC790",-1)),o("div",Ct,m(Q.value),1)]),o("div",Rt,[t[14]||(t[14]=o("div",{class:"col-auto t-column text-center body-border-left q-px-xs column justify-center"},"\uC218\uC815\uC790",-1)),o("div",Dt,m(K.value),1),t[15]||(t[15]=o("div",{class:"col-auto t-column text-center body-border-left q-px-xs column justify-center"},"\uC218\uC815\uC77C\uC790",-1)),o("div",It,m(L.value),1)])])),o("div",jt,[!i.value&&ae.value?(s(),y(f,{key:0,label:"\uC218\uC815",class:"q-ml-xs",onClick:ue})):u("",!0),i.value?(s(),y(f,{key:1,label:"\uCDE8\uC18C",class:"q-ml-xs",onClick:de})):u("",!0),i.value?(s(),y(f,{key:2,label:"\uC0AD\uC81C",class:"q-ml-xs",onClick:he})):u("",!0),i.value?(s(),y(f,{key:3,label:"\uC800\uC7A5",class:"q-ml-xs",onClick:ye})):u("",!0)])])]),_:1})]),_:1},512))}},po=Ae(Bt,[["__scopeId","data-v-10b7a75b"]]);export{po as default};
