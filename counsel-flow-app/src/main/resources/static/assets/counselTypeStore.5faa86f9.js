import{d as p}from"./index.02f7c95d.js";import{api as h}from"./axios.816e1a60.js";import{g as y}from"./header.10137493.js";import{h as f}from"./errorHandler.5efe1eb1.js";const m=(t,e)=>{let s=t?`/rest/api/v1/counsel/type/types/${t}`:"/rest/api/v1/counsel/type/types";return typeof e!="undefined"&&(s+=`?isTopCode=${e}`),h.get(s,y())},C=(t,e,s,n)=>h.post("/rest/api/v1/counsel/type/types",{entity:{code:t,name:e,orderNumber:n,parent:{entityId:s}}},y()),g=(t,e,s,n,r)=>{const i={code:e,name:s,orderNumber:r};return n&&(i.parent={entityId:n}),h.put(`/rest/api/v1/counsel/type/types/${t}`,{entity:i},y())},I=t=>h.post("/rest/api/v1/counsel/type/types/multiple",{entities:t},y()),A=t=>h.put("/rest/api/v1/counsel/type/types/multiple",{entities:t},y()),T=t=>h.delete(`/rest/api/v1/counsel/type/types/${t}`,y()),v=t=>{const e=t.join(",");return h.delete("/rest/api/v1/counsel/type/types",{...y(),params:{entityIds:e}})},c={getCounselType:m,saveCounselType:C,saveMultipleCounselType:I,updateMultipleCounselType:A,updateCounselType:g,deleteCounselType:T,deleteMultipleCounselTypes:v},M=p("counselTypeStore",{state:()=>({counselTypes:new Map,counselTypeArray:[],recid:1,initialLoaded:!1}),getters:{getCounselType:t=>(e,s)=>{if(!e)return null;let n=Array.isArray(e)?e:e.children;return n!=null&&n.length&&n.find(r=>r.code===s)||null},getCounselTypeName:t=>(e,s)=>{if(!e)return null;let n=Array.isArray(e)?e:e.children;if(!(n!=null&&n.length))return null;const r=n.find(i=>i.code===s);return r?r.name:null},getCounselTypeByEntityId:t=>(e,s)=>{if(!e)return null;let n=Array.isArray(e)?e:e.children;return n!=null&&n.length&&n.find(r=>r.entityId===s)||null},getChildrenCounselTypesByTopParentCodeValue:t=>e=>{const s=t.counselTypes.get(e);return(s==null?void 0:s.children)||[]},getChildrenCounselTypeNamesByTopParentCodeValue:t=>e=>{var n;const s=t.counselTypes.get(e);return((n=s==null?void 0:s.children)==null?void 0:n.map(r=>r.name))||[]},findCounselTypesInTopParentCodeValue:t=>(e,s,n)=>{function r(a,u,o){!(u!=null&&u.children)||u.children.forEach(d=>{d.code===o&&a.push(d),r(a,d,o)})}const i=[],l=t.counselTypes.get(e);return l&&r(i,l,s),n?i[0]||null:i},findCounselTypeNamesInTopParentCodeValue:t=>(e,s,n)=>{function r(a,u,o){!(u!=null&&u.children)||u.children.forEach(d=>{d.code===o&&a.push(d.name),r(a,d,o)})}const i=[],l=t.counselTypes.get(e);return l&&r(i,l,s),n?i[0]||null:i},findParentCounselTypeByChildren:t=>e=>{if(!(e!=null&&e.parentEntityId))return t.counselTypeArray;let s=null;function n(r){r.forEach(i=>{var l;e.parentEntityId===i.entityId?s=i.children||[]:(l=i.children)!=null&&l.length&&n(i.children)})}return n(t.counselTypeArray),s||t.counselTypeArray},findParentCode:t=>e=>{if(!(e!=null&&e.parentEntityId))return null;let s=null;function n(r){r.forEach(i=>{e.parentEntityId===i.entityId?s=i:i.children&&i.children.length>0&&n(i.children)})}return n(t.counselTypeArray),s},findIndexInParentCounselTypeChildren:t=>(e,s)=>e.findIndex(n=>n.entityId===s.entityId)},actions:{setCounselTypes(t){this.counselTypes=new Map,t.forEach(e=>{var s;(s=e.children)!=null&&s.length&&e.children.sort((n,r)=>n.orderNumber!==r.orderNumber?n.orderNumber-r.orderNumber:n.name.localeCompare(r.name)),this.counselTypes.set(e.code,e)})},setCounselTypeArray(t){this.recid=1;const e=(s,n)=>{s.sort((r,i)=>r.orderNumber!==i.orderNumber?r.orderNumber-i.orderNumber:r.name.localeCompare(i.name)),s.forEach(r=>{var i;r.recid=this.recid++,r.remarkText||(r.remarkText=""),n&&(r.parentCode=n.code,r.parentEntityId=n.entityId,r.parentRecid=n.recid,r.prevParentEntityId=n.entityId),(i=r.children)!=null&&i.length&&e(r.children,r)})};this.counselTypeArray=t,e(this.counselTypeArray)},load(){c.getCounselType(null,!1).then(t=>{t.status===200&&this.setCounselTypes(t.data)}).catch(t=>{f(t)}),c.getCounselType(null).then(t=>{t.status===200&&this.setCounselTypeArray(t.data)}).catch(t=>{f(t)})},fetchInitialData(){return this.initialLoaded?Promise.resolve():(this.initialLoaded=!0,Promise.all([c.getCounselType(null,!1),c.getCounselType(null)]).then(([t,e])=>{this.setCounselTypes(t.data),this.setCounselTypeArray(e.data)}).catch(t=>{throw this.initialLoaded=!1,t}))},clearInitialData(){this.initialLoaded=!1,this.clear()},clear(){this.setCounselTypes([]),this.setCounselTypeArray([])},async save(t){try{const e=await c.saveMultipleCounselType(t);return e.status===200&&this.load(),e}catch(e){throw e}},async update(t){try{const e=await c.updateMultipleCounselType(t);return e.status===200&&this.load(),e}catch(e){throw e}},async remove(t){try{const e=await c.deleteCounselType(t);return e.status===200&&this.load(),e}catch(e){throw e}},search(t={}){return new Promise(e=>{if(!t.name&&!t.code){e([]);return}const s=n=>n.reduce((r,i)=>{var o;const l={...i},a=!t.code||l.code.includes(t.code),u=!t.name||l.name.includes(t.name);return a&&u&&r.push(l),(o=l.children)!=null&&o.length&&r.push(...s(l.children)),r},[]);e(s(this.counselTypeArray))})}}});export{c,M as u};
