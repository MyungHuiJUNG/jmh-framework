import Y from"./TabulatorGrid.9c80b09d.js";import g from"./ABtn.e24d7e8a.js";import Z from"./ATitleBar.bbf1d9a4.js";import{u as G}from"./permissionStore.29c18612.js";import{s as O}from"./dialog.88ce899f.js";import{F as s}from"./FlowRoleCode.12cdb02e.js";import{aD as _,X as U,r as T,g as S,t as $,o as u,Y as b,a as k,$ as l,c as E,Z as w}from"./index.02f7c95d.js";/* empty css                                                             */import"./_plugin-vue_export-helper.cdc0426e.js";import"./ClosePopup.daa62b28.js";import"./permissionApi.ffe0b82d.js";import"./axios.816e1a60.js";import"./errorHandler.5efe1eb1.js";import"./authStore.fadf8446.js";import"./header.10137493.js";import"./counsel-hub.145170b4.js";import"./CommonPopup.2b0ee10b.js";import"./use-dialog-plugin-component.234e0905.js";const F={class:"fit column"},j={key:0,class:"text-right bg-grey-5 a-border q-pa-xs col-auto"},pe={__name:"TreeDepth",props:_({title:{type:String},data:{type:Array},typeName:{type:String},isTop:{type:Boolean,default:!1},parentEntity:{type:Object},viewType:{type:String,required:!0}},{modelValue:{},modelModifiers:{}}),emits:_(["rowSelected","deleteRow","saveRows","rowClick"],["update:modelValue"]),setup(v,{expose:I,emit:D}){const h=G(),m=U(v,"modelValue"),r=v,a=D;I({selectRow:J});const i=T([]),c=T(null),y={organization:{add:s.ORGANIZATION_ROLE.ADD,remove:s.ORGANIZATION_ROLE.DELETE,save:s.ORGANIZATION_ROLE.SAVE},counselType:{add:s.COUNSEL_TYPE_ROLE.ADD,remove:s.COUNSEL_TYPE_ROLE.DELETE,save:s.COUNSEL_TYPE_ROLE.SAVE}},R=r.viewType&&S(()=>h.hasPermission(y[r.viewType].add)),A=r.viewType&&S(()=>h.hasPermission(y[r.viewType].remove)),N=r.viewType&&S(()=>h.hasPermission(y[r.viewType].save)),C={headerSort:!1,resizable:!1,minWidth:30,width:30,rowHandle:!0,formatter:"handle"},x=[{title:"#",field:"rownum",formatter:"rownum",headerHozAlign:"center",hozAlign:"center",headerSort:!1,resizable:!1,width:50},{title:"\uCF54\uB4DC",field:"code",editor:"input",headerSort:!1,headerHozAlign:"center",hozAlign:"center",resizable:!1},{title:r.typeName,field:"name",editor:"input",headerSort:!1,headerHozAlign:"center",hozAlign:"left",resizable:!1}];$(()=>r.data,e=>{i.value=JSON.parse(JSON.stringify(e)),m.value=null});function z(e){a("rowClick",e)}function L(){var t;if(!r.isTop&&!((t=r.parentEntity)!=null&&t.entityId)){O("\uC0C1\uC704\uC720\uD615\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694.");return}i.value.unshift({code:"",name:""});let e=0;i.value.forEach(o=>{o.orderNumber=e+1,e++})}function P(){const e=c.value.getSelectedData();if(!(e!=null&&e.length)){a("deleteRow",null);return}for(const t of e)if(!t.entityId){const o=i.value.findIndex(n=>n===t);if(o!==-1){i.value.splice(o,1);return}}a("deleteRow",m.value.entityId)}function V(e){e.map(t=>{m.value={entityId:t.entityId,code:t.code},a("rowSelected",t)})}function J(e){c.value.deselectAllRows(),c.value.selectRows(e)}function M(e){e.map(t=>{a("rowSelected",t)}),m.value=null}function q(e){e.forEach((t,o)=>{t.orderNumber=o+1}),i.value=e}function B(){const e=JSON.parse(JSON.stringify(r.data)),t=c.value.getData(),{newRows:o,modifiedRows:n}=H(e,t);if([...o,...n].filter(f=>{var p;return((p=f.name)==null?void 0:p.length)>1024}).length){O("\uC774\uB984\uC740 1024\uC790\uB97C \uCD08\uACFC\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");return}((o==null?void 0:o.length)||(n==null?void 0:n.length))&&a("saveRows",{newRows:o,modifiedRows:n})}function H(e,t){const o=[],n=[];for(const d of t){const f=e.find(p=>p.entityId===d.entityId);f?JSON.stringify(d)!==JSON.stringify(f)&&n.push(d):o.push(d)}return{newRows:o,modifiedRows:n}}return(e,t)=>(u(),b("div",F,[k(Z,{title:v.title,class:"col-auto full-width q-mb-xs"},null,8,["title"]),k(Y,{rows:i.value,columns:x,"selectable-rows":1,"movable-rows":"","row-header":C,onRowSelected:V,onRowDeselected:M,onRowMoved:q,onRowClick:z,class:"full-width col",ref_key:"grid",ref:c},null,8,["rows"]),l(R)||l(A)||l(N)?(u(),b("div",j,[l(R)?(u(),E(g,{key:0,label:"\uCD94\uAC00",onClick:L})):w("",!0),l(A)?(u(),E(g,{key:1,label:"\uC0AD\uC81C",class:"q-ml-xs",onClick:P})):w("",!0),l(R)||l(N)?(u(),E(g,{key:2,label:"\uC800\uC7A5",class:"q-ml-xs",onClick:B})):w("",!0)])):w("",!0)]))}};export{pe as default};
